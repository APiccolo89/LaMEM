# Standard falling block test

# Define number of elements in x,y & z-direction
# Negative number implies corresponding number of mesh segments
# Data is provided in the variables seg_x, seg_y, seg_z and includes:
#    * coordinates of the delimiters between the segments (n-1 points)
#    * number of cells                                    (n points)
#    * bias coefficients                                  (n points) 

nel_x						=   128    
nel_y						= 	128    
nel_z						= 	128

# Geometry
DimensionalUnits		=	0			# Dimensionless (=0) or SI-dimensional units (=1)?
L						=	1			# Length (y-direction)
W						=	1			# Width  (x-direction)
H						=	1			# Height (z-direction)
x_left					=	0			# Left side of domain
y_front					=	0			# Front side of domain
z_bot					=	0			# Bottom of box

# --- Model setup and noise ---
msetup 					= spheres


# Define input/output and numerics-related stuff
OutputFile					=	MS_test		
save_timesteps				=	-1 				# save every ? timesteps
time_end					=	3				# last timestep
CFL							=	0.1				# CFL, dt-based criterium
dt_max						=	10000	  	   	# Maximum timestep [years if dimensional]
	
# Boundary conditions
BC.LeftBound				=	1				# 0 - free surface, 1-free slip with BG strainrate Eyy, 2 - no slip, 5 - growthrate 2D, 7 - growthrate 3D
BC.RightBound				=	1				# 0 - free surface, 1-free slip with BG strainrate Eyy, 2 - no slip, 5 - growthrate 2D, 7 - growthrate 3D
BC.FrontBound				=	1				# 0 - free surface, 1-free slip with BG strainrate Exx, 2 - no slip, 5 - growthrate 2D, 7 - growthrate 3D
BC.BackBound				=	1				# 0 - free surface, 1-free slip with BG strainrate Exx, 2 - no slip, 5 - growthrate 2D, 7 - growthrate 3D
BC.LowerBound				=	1				# 0 - free surface, 1-free slip, 				  2 - no slip, 5 - growthrate 2D, 7 - growthrate 3D
BC.UpperBound				=	1				# 0 - free surface, 1-free slip, 				  2 - no slip, 5 - growthrate 2D, 7 - growthrate 3D
Temp_top	    			=   0				# Temperature @ top
Temp_bottom					=   1 				# Temperature @ bottom; side BC's are flux-free


Characteristic.Length		=	10		# [m]		
Characteristic.Viscosity 	=	1		# [Pa.s]
Characteristic.Temperature	=	1		# [K]
Characteristic.Stress    	=   1		# [Pa]


<PetscOptionsStart>
	-DII_ref 1

	-dt 1e-3
	-pcmat_no_dev_proj
	-res_log
	
# SNES 
	-npicard 3
	-snes_monitor
	-snes_atol 1e-12
	-snes_rtol 1e-6
	-snes_stol 1e-6
	-snes_max_it 25
	-snes_max_funcs 50000
	-snes_type 		ksponly

# Jacobian KSP
	-js_ksp_type fgmres
	-js_ksp_gmres_restart 100
	-js_ksp_max_it 10000
	-js_ksp_min_it 1
	-js_ksp_converged_reason
 	-js_ksp_monitor_true_residual
	-js_ksp_rtol 1e-5
	-js_ksp_view
	#-ps_ksp_view		# pressure block


# Matrix type block factorization
	-pcmat_type block
	-jp_type bf
	
	-bf_vs_type mg
	-vs_ksp_type richardson
	-vs_ksp_max_it 3
	-vs_ksp_converged_reason	
	-vs_ksp_rtol 1e-10
#	-vs_ksp_monitor_true_residual

# MULTIGRID SETTINGS
	-gmg_pc_type mg
	-gmg_pc_mg_levels 4
	-gmg_pc_mg_galerkin
	-gmg_pc_mg_type multiplicative
	-gmg_pc_mg_cycle_type v
	-gmg_pc_view 
	-gmg_pc_mg_log		# monitors time spend in multigrid if using -log_summary
	
# RICHARDSON/JACOBI
	-gmg_mg_levels_ksp_type richardson
	-gmg_mg_levels_ksp_richardson_scale 0.5
	-gmg_mg_levels_pc_type jacobi
	-gmg_mg_levels_ksp_max_it 5
	
# CHEBYSHEV
#	-gmg_mg_levels_ksp_type chebyshev 
#	#-gmg_mg_levels_ 0.2,3.5				# estimate of low and upper bounds of eigenvalues
#	-gmg_mg_levels_ksp_chebyshev_estimate_eigenvalues 0,0.05,0,1.1		# zero times min. eigenvalue and 0.2*max. eigenvalue 
#	-gmg_mg_levels_pc_type jacobi
#	-gmg_mg_levels_ksp_max_it 20
	

# COARSE SOLVER
#   -crs_ksp_type preonly
#  -crs_pc_type lu
#  -crs_pc_factor_mat_solver_package mumps

# GAMG as coarse grid solver
    -crs_ksp_type preonly
    -crs_pc_type gamg
    -crs_pc_gamg_verbose 3
	-crs_pc_gamg_coarse_eq_limit 20
	-crs_pc_gamg_reuse_interpolation true
	-crs_pc_gamg_repartition true
	
   
   
	# Fine-tune solver options here (add command-line Petsc Options)
	-use_fdstag_canonical
	-AddRandomNoiseParticles 0
	-restart 0
	-save_breakpoints 0
#	-SavePartitioning

#	-objects_dump

	-out_pvd 1
	-out_phase 1  
	-out_density 1
	-out_viscosity 1
	-out_velocity 1
	-out_pressure 1
	-out_temperature 1 
	-out_dev_stress 1
	-out_j2_dev_stress 1
	-out_strain_rate 1
	-out_j2_strain_rate 1
	-out_plast_strain 1
	
	-AVDPhaseViewer 1
	
	-objects_dump
<PetscOptionsEnd>
    
# Phase distribution
NumPartX				=	2   # Particles/Cell in x-direction
NumPartY				=	2   # Particles/Cell in y-direction
NumPartZ				=	2	# Particles/Cell in z-direction

# Properties that are defined over the whole domain:
Gravity					=  -9.8;									# [m/s2] - gravitational acceleration 
PlasticityModel			=	0;									#  not implemented yet
Xi						=	0;									# [ ] - Shear heating factor - not implemented yet

# Define phase transitions for particles
num_phase_transitions			=	0				# The number of phase transitions present
LowerViscosityCutoff			=	1e-10
UpperViscosityCutoff			=	1e10

# Define material properties for all phases -------------------------------------------------
new_input = 1

	# MATRIX --------------------------------
	<MaterialStart>
		ID 			=	0		# phase id  [-]
		rho0        = 	1		# density 
		eta			= 	1e0	# viscosity
	<MaterialEnd>
	
	# BLOCK --------------------------------
	<MaterialStart>
		ID 			=	1		# phase id  [-]
		rho0        = 	1.2		# density 
		eta			= 	1e3		# viscosity
	<MaterialEnd>

# End of defining material properties for all phases ----------------------------------------
