# PureShear_FDSTAG
#	(2D) Example of a pure shear, multilayer folding test with FDSTAG in which the FDSTAG mesh is deformed as well.
#

# Define number of elements in x,y & z-direction @ coarsest level (should be uneven!)
nel_x	   					=	64     
nel_y						= 	2    
nel_z						= 	32
levels						= 	1			# number of multigrid levels

# Geometry
DimensionalUnits			=	1;			# Dimensionless (=0) or SI-dimensional units (=1)?
L							=	1e3			# Length (y-direction)
W							=	200e3		# Width  (x-direction)
H							=	8e3			# Height (z-direction)
x_left						=	0e3		    # Left side of domain
y_front						=	0			# Front side of domain
z_bot						=	0e3			# Bottom of box

# Define model setup and noise
Setup.Model					=	9						# 0-Diapir,9-multilayer folding with interfaces defined @ command-line
ParticleFilename			=   ParticlesInput3D.dat	# File that contains particle distribution
ampl2D						=	0e3 					# Amplitude of 2D sinuoidal perturbation [m]
ampl3D						=	0e2						# Amplitude of 3D sinuoidal perturbation [m]
amplNoise					=	3e2						# Amplitude of noise @ interface  [m]

# Define input/output and numerics-related stuff
OutputFile					=	PureShearFolding_FDSTAG_Output
save_timesteps				=	5			# save every ? timesteps
time_end					=	1000			# last timestep
CFL							=	0.5			# CFL, dt-based criterium 
dt_max						=	1e6  	    # Maximum timestep [years if dimensional]
		
# Boundary conditions
BC.Eyy						=	0e-15		# BG strainrate in y-direction
BC.Exx						=	1e-15		# BG Strainrate in x-direction
BC.LeftBound				=	1			# 0 - free surface, 1-free slip with BG strainrate Eyy, 2 - no slip
BC.RightBound				=	1			# 0 - free surface, 1-free slip with BG strainrate Eyy, 2 - no slip
BC.FrontBound				=	1			# 0 - free surface, 1-free slip with BG strainrate Exx, 2 - no slip
BC.BackBound				=	1			# 0 - free surface, 1-free slip with BG strainrate Exx, 2 - no slip
BC.LowerBound				=	1			# 0 - free surface, 1-free slip, 						2 - no slip
BC.UpperBound				=	1			# 0 - free surface, 1-free slip, 						2 - no slip
Temp_top	    			=   0;			# Temperature @ top
Temp_bottom   				=   1000;		# Temperature @ bottom; side BC's are flux-free

# Grid advection method
GridAdvectionMethod 		= 	0 		# 0-Fully Eulerian, 1-Fully Lagrangian, 2-ALE with remeshing @ surface layer
FactorSurfaceLayer  		= 	0.3 	# How thick is the surface layer (if option 2 is selected above) ?

# Parameters that control the internal sedimentation/fast erosion rate
UseInternalFreeSurface         =       1               	# 0-no; 1-yes
StickyAirPhase                 =       8        			# which of the phases describes the sticky air?
InitialFreeSurfaceHeight       =       6.5e3   			# The height of the initial free surface
FSSA 						   =	   1.0					# Free surface stabilization parameter [0-1]; 0-off


# Define solver and set options for Uzawa
SolverType					=	4		# 2-KSP, 3-Direct [serial!],  4 - MUMPS, 5-GMG
UzawaSolver 				=	3		# 1-Schur/FGMRES;  2-Old way (CG);  3-Powell Hesteness iterations, 4- FC solver
MaximumDivergence  			=   1e-10    # Cutoff divergence
Uzawa_RelInnerAccuracy  	=   1e-8    # Cutoff inner error for preconditioning step in Uzawa iterations
Uzawa_MaxInnerIterations 	=   50		# Maximum number of inner iterations
  
<PetscOptionsStart>
	# Fine-tune solver options here (add command-line Petsc Options)
	-vpt_element FDSTAG 				# Type of element [Q2Pm1_global; Q2Pm1_local; Q1P0; Q1Q1]
	
	# some slab-setup specific parameters
	-MaximumSurfaceAngle 45
	-save_breakpoints 0
	-incr_breakpoints 100
	-AddRandomNoiseParticles 0		# no random noise added
	
	 # interface between salt and overburden:
     -Hinterface 0.3
        
     # Other interfaces
     -Layer1_bottom 0.3
     -Layer1_top    0.35
        
     -Layer2_bottom 0.35
     -Layer2_top    0.4
        
     -Layer3_bottom 0.4
     -Layer3_top    0.45
        
     -Layer4_bottom 0.45
     -Layer4_top    0.5
        
     -Layer5_bottom 0.5
     -Layer5_top    0.55
        
	-Layer6_bottom 0.55
	-Layer6_top    0.60
	
	-Layer7_bottom 0.6
	-Layer7_top    0.65
	


	-AVDPhaseViewer 1
    -AVDPhaseViewer_factor 4
        
	
	-use_stokes_monitor
	-use_stokes_residual
	#-use_stokes_norm_Linf
	
	-use_stokes_relative_norm 
	-use_stokes_norm_L2
	-fc_ksp_converged_reason
	
	

	-fc_ksp_type gcrext			# cheap to compute residuals
	-fc_ksp_atol 1.0e-5			# cutoff divergence
	-fc_ksp_rtol 1.0e-8		# cutoff divergence
	
	
	-A11_ksp_type fgmres 
	-A11_pc_type fieldsplit 

	
	#----------------------------------------------------------------
	# parameters in case we want to use ML as a preconditioner:
	# This effort was stopped @ some point as GMG is often cheaper in terms
	# of memory
	#
	# Note: if you so this, set SolverType	=	2, above
	#
	-A11_fieldsplit_ksp_type 		preonly 
	-A11_fieldsplit_ksp_rtol 		1e-2 
	-A11_fieldsplit_pc_type 		ml 
	-A11_pc_fieldsplit_block_size  	3				# 3 DOF's
	-A11_pc_fieldsplit_type 		ADDITIVE 
	-A11_ksp_rtol 					1e-3 
	#-A11_ksp_converged_reason 
	#-A11_ksp_monitor 

	#
	#----------------------------------------------------------------
	
	
<PetscOptionsEnd>
  
    
# Phase distribution
ParticleInput 				=   1						# Use particles to track properties? 0-no; 1-yes
SaveTracers 				=   1             			# Write particles to disk?
NumPartX					=	4						# Particles/Cell in x-direction
NumPartY					=	4						# Particles/Cell in y-direction
NumPartZ					=	4						# Particles/Cell in z-direction

# Read initial grid from file?
InitialMeshFromFile 		=   0				#   In case you want to hand-modify the initial grid
 
# Properties that are defined over the whole domain:
Gravity						=	0;				# [m/s2] - gravitational acceleration 
PlasticityModel				=	0;				#  not implemented yet
Xi							=	0;				# [ ] - Shear heating factor - not implemented yet

# Define characteristic values, used if DimensionalUnits==1, otherwise ignored
Characteristic.Length		=	10e3			# [m]
Characteristic.Viscosity 	=	1e20		# [Pa.s]
Characteristic.Temperature	=	1000		# [K]
Characteristic.Stress      	=   1e6			# [Pa]	


# Define phase transitions for particles
num_phase_trans				=	0			# The number of phase transitions present

# Define material properties for all phases -------------------------------------------------
num_phases					=	9		# Total number of phases defined in code

	# Define properties of Salt-------------------
	<MaterialStart>
		phase_id 			=	0
		attribute 			= 	VISCOSITY
		type 				= 	constant
		eta0       			= 	1.0e19	
	<MaterialEnd>
	<MaterialStart>
		phase_id			= 	0
		attribute 			= 	DENSITY
		type 				= 	temperature_dependent
		rho0        		= 	2700
		alpha 				=	0
	<MaterialEnd>
	<MaterialStart>
		phase_id			= 	0
		attribute 			= 	ELASTICITY
		type 				= 	constant
		shear        		= 	5e1000
	<MaterialEnd>
	<MaterialStart>
		phase_id			= 	0
		attribute 			= 	ENERGY
		type 				= 	constant
		ThermalConductivity	= 	3
		HeatCapacity		=	1050
		RadioactiveHeat		=	0
		ShearHeating		=	0
	<MaterialEnd>
	
	# Define properties of Sediments 1 -----------------
	<MaterialStart>
		phase_id 			=	1
		attribute 			= 	VISCOSITY
		type 				= 	constant
		eta0       			= 	1.0e22
	<MaterialEnd>
	<MaterialStart>
		phase_id			= 	1
		attribute 			= 	ELASTICITY
		type 				= 	constant
		shear        		= 	5e1000
	<MaterialEnd>
	<MaterialStart>
		phase_id 			= 	1
		attribute 			= 	DENSITY
		type 				= 	temperature_dependent
		rho0        		= 	2700
		alpha 				=	0
	<MaterialEnd>
	
	<MaterialStart>
		phase_id			= 	1
		attribute 			= 	ENERGY
		type 				= 	constant
		ThermalConductivity	= 	3
		HeatCapacity		=	1050
		RadioactiveHeat		=	0
		ShearHeating		=	0
	<MaterialEnd>

	# Define properties of Sediments 2 -----------------
	<MaterialStart>
		phase_id 			=	2
		attribute 			= 	VISCOSITY
		type 				= 	constant
		eta0       			= 	1.0e20
	<MaterialEnd>
	<MaterialStart>
		phase_id			= 	2
		attribute 			= 	ELASTICITY
		type 				= 	constant
		shear        		= 	5e1000
	<MaterialEnd>
	<MaterialStart>
		phase_id 			= 	2
		attribute 			= 	DENSITY
		type 				= 	temperature_dependent
		rho0        		= 	2700
		alpha 				=	0
	<MaterialEnd>
	
	<MaterialStart>
		phase_id			= 	2
		attribute 			= 	ENERGY
		type 				= 	constant
		ThermalConductivity	= 	3
		HeatCapacity		=	1050
		RadioactiveHeat		=	0
		ShearHeating		=	0
	<MaterialEnd>
	
	# Define properties of Sediments 3 -----------------
	<MaterialStart>
		phase_id 			=	3
		attribute 			= 	VISCOSITY
		type 				= 	constant
		eta0       			= 	1.0e21
	<MaterialEnd>
	<MaterialStart>
		phase_id			= 	3
		attribute 			= 	ELASTICITY
		type 				= 	constant
		shear        		= 	5e1000
	<MaterialEnd>
	<MaterialStart>
		phase_id 			= 	3
		attribute 			= 	DENSITY
		type 				= 	temperature_dependent
		rho0        		= 	2700
		alpha 				=	0
	<MaterialEnd>
	
	<MaterialStart>
		phase_id			= 	3
		attribute 			= 	ENERGY
		type 				= 	constant
		ThermalConductivity	= 	3
		HeatCapacity		=	1050
		RadioactiveHeat		=	0
		ShearHeating		=	0
	<MaterialEnd>
	
		# Define properties of Sediments 4 -----------------
	<MaterialStart>
		phase_id 			=	4
		attribute 			= 	VISCOSITY
		type 				= 	constant
		eta0       			= 	1.0e20
	<MaterialEnd>
	<MaterialStart>
		phase_id			= 	4
		attribute 			= 	ELASTICITY
		type 				= 	constant
		shear        		= 	5e1000
	<MaterialEnd>
	<MaterialStart>
		phase_id 			= 	4
		attribute 			= 	DENSITY
		type 				= 	temperature_dependent
		rho0        		= 	2700
		alpha 				=	0
	<MaterialEnd>
	
	<MaterialStart>
		phase_id			= 	4
		attribute 			= 	ENERGY
		type 				= 	constant
		ThermalConductivity	= 	3
		HeatCapacity		=	1050
		RadioactiveHeat		=	0
		ShearHeating		=	0
	<MaterialEnd>
	
	# Define properties of Sediments 5 -----------------
	<MaterialStart>
		phase_id 			=	5
		attribute 			= 	VISCOSITY
		type 				= 	constant
		eta0       			= 	1.0e22
	<MaterialEnd>
	<MaterialStart>
		phase_id			= 	5
		attribute 			= 	ELASTICITY
		type 				= 	constant
		shear        		= 	5e1000
	<MaterialEnd>
	<MaterialStart>
		phase_id 			= 	5
		attribute 			= 	DENSITY
		type 				= 	temperature_dependent
		rho0        		= 	2700
		alpha 				=	0
	<MaterialEnd>
	
	<MaterialStart>
		phase_id			= 	5
		attribute 			= 	ENERGY
		type 				= 	constant
		ThermalConductivity	= 	3
		HeatCapacity		=	1050
		RadioactiveHeat		=	0
		ShearHeating		=	0
	<MaterialEnd>
	
	# Define properties of Sediments 6 -----------------
	<MaterialStart>
		phase_id 			=	6
		attribute 			= 	VISCOSITY
		type 				= 	constant
		eta0       			= 	1.0e20
	<MaterialEnd>
	<MaterialStart>
		phase_id			= 	6
		attribute 			= 	ELASTICITY
		type 				= 	constant
		shear        		= 	5e1000
	<MaterialEnd>
	<MaterialStart>
		phase_id 			= 	6
		attribute 			= 	DENSITY
		type 				= 	temperature_dependent
		rho0        		= 	2700
		alpha 				=	0
	<MaterialEnd>
	
	<MaterialStart>
		phase_id			= 	6
		attribute 			= 	ENERGY
		type 				= 	constant
		ThermalConductivity	= 	3
		HeatCapacity		=	1050
		RadioactiveHeat		=	0
		ShearHeating		=	0
	<MaterialEnd>
	
	# Define properties of Sediments 7 -----------------
	<MaterialStart>
		phase_id 			=	7
		attribute 			= 	VISCOSITY
		type 				= 	constant
		eta0       			= 	1.0e22
	<MaterialEnd>
	<MaterialStart>
		phase_id			= 	7
		attribute 			= 	ELASTICITY
		type 				= 	constant
		shear        		= 	5e1000
	<MaterialEnd>
	<MaterialStart>
		phase_id 			= 	7
		attribute 			= 	DENSITY
		type 				= 	temperature_dependent
		rho0        		= 	2700
		alpha 				=	0
	<MaterialEnd>
	
	<MaterialStart>
		phase_id			= 	7
		attribute 			= 	ENERGY
		type 				= 	constant
		ThermalConductivity	= 	3
		HeatCapacity		=	1050
		RadioactiveHeat		=	0
		ShearHeating		=	0
	<MaterialEnd>
	
	# Define properties of Air -----------------
	<MaterialStart>
		phase_id 			=	8
		attribute 			= 	VISCOSITY
		type 				= 	constant
		eta0       			= 	1.0e17	
	<MaterialEnd>
	<MaterialStart>
		phase_id			= 	8
		attribute 			= 	ELASTICITY
		type 				= 	constant
		shear        		= 	5e1000
	<MaterialEnd>
	<MaterialStart>
		phase_id 			= 	8
		attribute 			= 	DENSITY
		type 				= 	temperature_dependent
		rho0        		= 	2700
		alpha 				=	0
	<MaterialEnd>
	
	<MaterialStart>
		phase_id			= 	8
		attribute 			= 	ENERGY
		type 				= 	constant
		ThermalConductivity	= 	3
		HeatCapacity		=	1050
		RadioactiveHeat		=	0
		ShearHeating		=	0
	<MaterialEnd>	
	
	
	
# End of defining material properties for all phases ----------------------------------------



