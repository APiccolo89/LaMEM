# Model cross-lithospheric melt channels.
#
# $Id: DetachmentFolding_Zagros_Viscous_3D.dat 1578 2011-03-18 15:09:57Z kausb $

# Define number of elements in x,y & z-direction 
nel_x					=	64    
nel_y					= 	8  
nel_z					= 	64					
levels					= 	1			# number of multigrid levels

# Geometry
DimensionalUnits		=	1			# Dimensionless (=0) or SI-dimensional units (=1)?
L						=	25e3		# Length (y-direction)
W						=	200e3		# Width  (x-direction)
H						=	200e3		# Height (z-direction)
x_left					=	-100e3		# Left side of domain
y_front					=	0e3			# Front side of domain
z_bot					=	-200e3		# Bottom of box

# Define model setup and noise
Setup.Model				=	0			# 0-diapir ; 2- Falling Block
ampl2D					=	0.0	 		# Amplitude of 2D sinuoidal perturbtion
ampl3D					=	0.0			# Amplitude of 3D sinuoidal perturbtion
amplNoise				=   0	 		# Amplitude of noise @ interface

# Define input/output and numerics-related stuff
OutputFile				=	LithosphericChannels
save_timesteps			=	5			# save every ? timesteps
time_end				=	500			# last timestep
CFL						=	0.5			# CFL, dt-based criterium
dt_max					=	50e3	  	# Maximum timestep [years if dimensional]
	
# Boundary conditions
BC.Eyy					=	0e-15		# BG strainrate in y-direction
BC.Exx					=	0e-15		# BG Strainrate in x-direction
BC.LeftBound			=	1			# 0 - free surface, 1-free slip with BG strainrate Eyy, 2 - no slip, 3-periodic
BC.RightBound			=	1			# 0 - free surface, 1-free slip with BG strainrate Eyy, 2 - no slip, 3-periodic
BC.FrontBound			=	1			# 0 - free surface, 1-free slip with BG strainrate Exx, 2 - no slip, 5 - growthrate 2D, 7 - growthrate 3D
BC.BackBound			=	1			# 0 - free surface, 1-free slip with BG strainrate Exx, 2 - no slip, 5 - growthrate 2D, 7 - growthrate 3D
BC.LowerBound			=	1			# 0 - free surface, 1-free slip, 				  2 - no slip, 5 - growthrate 2D, 7 - growthrate 3D
BC.UpperBound			=	1			# 0 - free surface, 1-free slip, 				  2 - no slip, 5 - growthrate 2D, 7 - growthrate 3D
Temp_top	    		=   0			# Temperature @ top
Temp_bottom				=   1000 		# Temperature @ bottom; side BC's are flux-free

# Grid advection method
GridAdvectionMethod		= 	0 				# 0-Fully Eulerian, 1-Fully Lagrangian, 2-ALE with remeshing @ surface layer
FactorSurfaceLayer		= 	1 				# How thick is the surface layer (if option 2 is selected above) ?

# Define solver and set options for Uzawa
SolverType					=	2			# 1-Multigrid, 2-KSP, 3-Direct [serial!], 4-MUMPS
UzawaSolver 				=	4			# 1-Schur/FGMRES;  2-Old way (CG);  3-Powell Hesteness iterations, 4-FC
MG_Solver					=	1			# 0-default, 1-richa/bjac, 2-richa/jac, 3-richa/sor
MG_Scale					=	0.6			# Scale employed if MS_solver==1,2 or 3
SmoothUp					=   2           # Number of smoothing steps on finest level
SmootherMethod      		=   0           # 0-keep as in fine level, 1-increase steps on coarser levels 
MaximumDivergence  			=   1e-6        # Cutoff divergence
Uzawa_RelInnerAccuracy		=   1e-6        # Cutoff inner error for preconditioning step in Uzawa iterations
Uzawa_MaxInnerIterations	=   200			# Maximum number of inner iterations
NonlinearIterationsAccuracy	= 	1e-5		# Stopping criterium for power-law loop
MaxNonlinearIterations		= 	25			# Maximum number of nonlinear iterations


<PetscOptionsStart>
	# Fine-tune solver options here (add command-line Petsc Options)
	-vpt_element FDSTAG			# Type of element [Q2Pm1_global; Q2Pm1_local; Q1P0]
	
	# interface between salt and overburden:
	-ParticleInjectionPhase 0 	# inject sediments
	#-EulerianAfterTimestep 	5	# switch to an Eulerian mode of deformation
	
	
	# activate visualization of the phase information:
	-AVDPhaseViewer 1
	-AVDPhaseViewer_factor 4
	
	
	
	# Fully coupled solver options:
	#-fc_ksp_view
	
	-use_stokes_monitor
	-use_stokes_residual
	-use_stokes_norm_Linf
	
	-use_stokes_relative_norm 
	-use_stokes_norm_L2
	-fc_ksp_converged_reason
	
	

	-fc_ksp_type gcrext			# cheap to compute residuals
	-fc_ksp_atol 1.0e-6			# cutoff divergence
	-fc_ksp_rtol 1.0e-5			# cutoff divergence
	
	

	
	#--------------
	# Use direct solver as an initial guess [switch  to an iterative one as soon as the setup works]
	#-A11_ksp_type preonly
	#-A11_pc_type lu
	
	
		
	
	#----------------------------------------------------------------
	# parameters in case we want to use ML as a preconditioner:
	# This effort was stopped @ some point as GMG is often cheaper in terms
	# of memory
	#
	# Note: if you so this, set SolverType	=	2, above
	#

	-A11_ksp_type fgmres 
	-A11_pc_type fieldsplit 

	-A11_fieldsplit_ksp_type 		preonly 
	-A11_fieldsplit_ksp_rtol 		1e-2 
	-A11_fieldsplit_pc_type 		ml 
	-A11_pc_fieldsplit_block_size  	3				# 3 DOF's
	-A11_pc_fieldsplit_type 		ADDITIVE 
	-A11_ksp_rtol 					1e-2 
	-A11_ksp_converged_reason 
#	-A11_ksp_monitor 
	
	
	-A11_fieldsplit_mg_coarse_ksp_type 						preonly
	-A11_fieldsplit_mg_coarse_pc_type 						lu
	-A11_fieldsplit_mg_coarse_pc_factor_mat_solver_package 	mumps
	#-A11_fieldsplit_ksp_view
	#-A11_fieldsplit_ksp_converged_reason
	-A11_fieldsplit_converged_reason 
	
	#
	#
	# max number of levels
	#-A11_fieldsplit_pc_ml_maxNlevels 		3
	
	#smoothers in ML [quite weak!!]
	-A11_fieldsplit_mg_levels_ksp_type 		richardson
	-A11_fieldsplit_mg_levels_ksp_max_it  	4
	-A11_fieldsplit_mg_levels_pc_type 		bjacobi
	#
	#----------------------------------------------------------------
	
	
	
<PetscOptionsEnd>

# Phase distribution
ParticleInput 			=   1					# Use particles to track properties? 0-no; 1-yes
NumPartX				=	4					# Particles/Cell in x-direction
NumPartY				=	4					# Particles/Cell in y-direction
NumPartZ				=	4					# Particles/Cell in z-direction

# Read initial grid from file?
InitialMeshFromFile 	=   0								# In case you want to hand-modify the initial grid
LoadInitialParticlesFromDisc = 0
ParticleFilename      	=  	Initial_Particles.dat
SaveTracers 			=	0

# Properties that are defined over the whole domain:
Gravity					=	10;						# [m/s2] - gravitational acceleration 
PlasticityModel			=	0;						#  not implemented yet
Xi						=	0;						# [ ] - Shear heating factor - not implemented yet

# Define characteristic values, used if DimensionalUnits==1, otherwise ignored
Characteristic.Length			=	100e3			# [m]
Characteristic.Viscosity 		=	1e20			# [Pa.s]
Characteristic.Temperature		=	1				# [K]
Characteristic.Stress      		=   1e6				# [Pa]

# Define phase transitions for particles
num_phase_transitions			=	0				# The number of phase transitions present

# Define material properties for all phases -------------------------------------------------
num_phases					=	9		# Total number of phases defined in code
LowerViscosityCutoff		=	1e17;
UpperViscosityCutoff		=	1e25;
	
	
	# Define properties of asthenosphere [0]-----------------
	<MaterialStart>
		phase_id 			=	0
		attribute 			= 	VISCOSITY
		type 				= 	constant 					
		eta0       			= 	1e20	
	<MaterialEnd>
	<MaterialStart>
		phase_id			= 	0
		attribute 			= 	ELASTICITY
		type 				= 	constant
		shear        		= 	5e100
	<MaterialEnd>
	<MaterialStart>
		phase_id			= 	0
		attribute 			= 	PLASTICITY
		type 				= 	DruckerPrager
		Cohesion        	= 	40e600
		FrictionAngle		= 	0
	<MaterialEnd>
	<MaterialStart>
		phase_id 			= 	0
		attribute 			= 	DENSITY
		type 				= 	temperature_dependent
		rho0        		= 	3200
		alpha 				=	0
	<MaterialEnd>
	<MaterialStart>
		phase_id			= 	0
		attribute 			= 	ENERGY
		type 				= 	constant
		ThermalConductivity	= 	3
		HeatCapacity		=	1050
		RadioactiveHeat		=	0
		ShearHeating		=	0
	<MaterialEnd>
	
	
	
	# Define properties of mantle lithosphere [1]----------------
	<MaterialStart>
		phase_id 			=	1
		attribute 			= 	VISCOSITY
		type 				= 	power_law
		eta0       			= 	1e23
		N_exp				=	1
		e0					=	1e-15	
	<MaterialEnd>
	<MaterialStart>
		phase_id			= 	1
		attribute 			= 	ELASTICITY
		type 				= 	constant
		shear        		= 	5e100
	<MaterialEnd>
	<MaterialStart>
		phase_id			= 	1
		attribute 			= 	PLASTICITY
		type 				= 	DruckerPrager
		Cohesion        	= 	50e600
		FrictionAngle		= 	0
	<MaterialEnd>
	
	<MaterialStart>
		phase_id			= 	1
		attribute 			= 	DENSITY
		type 				= 	temperature_dependent
		rho0        		= 	3200
		alpha 				=	0
	<MaterialEnd>
	<MaterialStart>
		phase_id			= 	1
		attribute 			= 	ENERGY
		type 				= 	constant
		ThermalConductivity	= 	3
		HeatCapacity		=	1050
		RadioactiveHeat		=	0
		ShearHeating		=	0
	<MaterialEnd>
	
		
	# Define properties of lower crust 1 [2]----------------
	<MaterialStart>
		phase_id 			=	2
		attribute 			= 	VISCOSITY
		type 				= 	power_law
		eta0       			= 	1e19
		N_exp				=	1
		e0					=	1e-15	
	<MaterialEnd>
	<MaterialStart>
		phase_id			= 	2
		attribute 			= 	ELASTICITY
		type 				= 	constant
		shear        		= 	5e100
	<MaterialEnd>
	<MaterialStart>
		phase_id			= 	2
		attribute 			= 	PLASTICITY
		type 				= 	DruckerPrager
		Cohesion        	= 	50e600
		FrictionAngle		= 	0
	<MaterialEnd>
	
	<MaterialStart>
		phase_id			= 	2
		attribute 			= 	DENSITY
		type 				= 	temperature_dependent
		rho0        		= 	3000
		alpha 				=	0
	<MaterialEnd>
	<MaterialStart>
		phase_id			= 	2
		attribute 			= 	ENERGY
		type 				= 	constant
		ThermalConductivity	= 	3
		HeatCapacity		=	1050
		RadioactiveHeat		=	0
		ShearHeating		=	0
	<MaterialEnd>
	
	# Define properties of lower crust 2 [3]----------------
	<MaterialStart>
		phase_id 			=	3
		attribute 			= 	VISCOSITY
		type 				= 	power_law
		eta0       			= 	1e19
		N_exp				=	1
		e0					=	1e-15	
	<MaterialEnd>
	<MaterialStart>
		phase_id			= 	3
		attribute 			= 	ELASTICITY
		type 				= 	constant
		shear        		= 	5e100
	<MaterialEnd>
	<MaterialStart>
		phase_id			= 	3
		attribute 			= 	PLASTICITY
		type 				= 	DruckerPrager
		Cohesion        	= 	50e600
		FrictionAngle		= 	0
	<MaterialEnd>
	
	<MaterialStart>
		phase_id			= 	3
		attribute 			= 	DENSITY
		type 				= 	temperature_dependent
		rho0        		= 	3000
		alpha 				=	0
	<MaterialEnd>
	<MaterialStart>
		phase_id			= 	3
		attribute 			= 	ENERGY
		type 				= 	constant
		ThermalConductivity	= 	3
		HeatCapacity		=	1050
		RadioactiveHeat		=	0
		ShearHeating		=	0
	<MaterialEnd>
	
	
	# Define properties of upper crust 1 [4]----------------
	<MaterialStart>
		phase_id 			=	4
		attribute 			= 	VISCOSITY
		type 				= 	power_law
		eta0       			= 	1e22
		N_exp				=	1
		e0					=	1e-15	
	<MaterialEnd>
	<MaterialStart>
		phase_id			= 	4
		attribute 			= 	ELASTICITY
		type 				= 	constant
		shear        		= 	5e100
	<MaterialEnd>
	<MaterialStart>
		phase_id			= 	4
		attribute 			= 	PLASTICITY
		type 				= 	DruckerPrager
		Cohesion        	= 	50e600
		FrictionAngle		= 	0
	<MaterialEnd>
	
	<MaterialStart>
		phase_id			= 	4
		attribute 			= 	DENSITY
		type 				= 	temperature_dependent
		rho0        		= 	2800
		alpha 				=	0
	<MaterialEnd>
	<MaterialStart>
		phase_id			= 	4
		attribute 			= 	ENERGY
		type 				= 	constant
		ThermalConductivity	= 	3
		HeatCapacity		=	1050
		RadioactiveHeat		=	0
		ShearHeating		=	0
	<MaterialEnd>


	# Define properties of upper crust 2 [5]----------------
	<MaterialStart>
		phase_id 			=	1
		attribute 			= 	VISCOSITY
		type 				= 	power_law
		eta0       			= 	1e22
		N_exp				=	1
		e0					=	1e-15	
	<MaterialEnd>
	<MaterialStart>
		phase_id			= 	1
		attribute 			= 	ELASTICITY
		type 				= 	constant
		shear        		= 	5e100
	<MaterialEnd>
	<MaterialStart>
		phase_id			= 	1
		attribute 			= 	PLASTICITY
		type 				= 	DruckerPrager
		Cohesion        	= 	50e600
		FrictionAngle		= 	0
	<MaterialEnd>
	
	<MaterialStart>
		phase_id			= 	1
		attribute 			= 	DENSITY
		type 				= 	temperature_dependent
		rho0        		= 	2800
		alpha 				=	0
	<MaterialEnd>
	<MaterialStart>
		phase_id			= 	1
		attribute 			= 	ENERGY
		type 				= 	constant
		ThermalConductivity	= 	3
		HeatCapacity		=	1050
		RadioactiveHeat		=	0
		ShearHeating		=	0
	<MaterialEnd>

	
	# Define properties of sticky air [6]----------------
	<MaterialStart>
		phase_id 			=	6
		attribute 			= 	VISCOSITY
		type 				= 	power_law
		eta0       			= 	1e20
		N_exp				=	1
		e0					=	1e-15	
	<MaterialEnd>
	<MaterialStart>
		phase_id			= 	6
		attribute 			= 	ELASTICITY
		type 				= 	constant
		shear        		= 	5e100
	<MaterialEnd>
	<MaterialStart>
		phase_id			= 	6
		attribute 			= 	PLASTICITY
		type 				= 	DruckerPrager
		Cohesion        	= 	50e600
		FrictionAngle		= 	0
	<MaterialEnd>
	
	<MaterialStart>
		phase_id			= 	6
		attribute 			= 	DENSITY
		type 				= 	temperature_dependent
		rho0        		= 	2800
		alpha 				=	0
	<MaterialEnd>
	<MaterialStart>
		phase_id			= 	6
		attribute 			= 	ENERGY
		type 				= 	constant
		ThermalConductivity	= 	3
		HeatCapacity		=	1050
		RadioactiveHeat		=	0
		ShearHeating		=	0
	<MaterialEnd>

	# Define properties of weak channel [7]----------------
	<MaterialStart>
		phase_id 			=	7
		attribute 			= 	VISCOSITY
		type 				= 	power_law
		eta0       			= 	1e19
		N_exp				=	1
		e0					=	1e-15	
	<MaterialEnd>
	<MaterialStart>
		phase_id			= 	7
		attribute 			= 	ELASTICITY
		type 				= 	constant
		shear        		= 	5e100
	<MaterialEnd>
	<MaterialStart>
		phase_id			= 	7
		attribute 			= 	PLASTICITY
		type 				= 	DruckerPrager
		Cohesion        	= 	50e600
		FrictionAngle		= 	0
	<MaterialEnd>
	
	<MaterialStart>
		phase_id			= 	7
		attribute 			= 	DENSITY
		type 				= 	temperature_dependent
		rho0        		= 	3200
		alpha 				=	0
	<MaterialEnd>
	<MaterialStart>
		phase_id			= 	7
		attribute 			= 	ENERGY
		type 				= 	constant
		ThermalConductivity	= 	3
		HeatCapacity		=	1050
		RadioactiveHeat		=	0
		ShearHeating		=	0
	<MaterialEnd>

	# Define properties of diapir [8]----------------
	<MaterialStart>
		phase_id 			=	8
		attribute 			= 	VISCOSITY
		type 				= 	power_law
		eta0       			= 	1e19
		N_exp				=	1
		e0					=	1e-15	
	<MaterialEnd>
	<MaterialStart>
		phase_id			= 	8
		attribute 			= 	ELASTICITY
		type 				= 	constant
		shear        		= 	5e100
	<MaterialEnd>
	<MaterialStart>
		phase_id			= 	8
		attribute 			= 	PLASTICITY
		type 				= 	DruckerPrager
		Cohesion        	= 	50e600
		FrictionAngle		= 	0
	<MaterialEnd>
	
	<MaterialStart>
		phase_id			= 	8
		attribute 			= 	DENSITY
		type 				= 	temperature_dependent
		rho0        		= 	3100
		alpha 				=	0
	<MaterialEnd>
	<MaterialStart>
		phase_id			= 	8
		attribute 			= 	ENERGY
		type 				= 	constant
		ThermalConductivity	= 	3
		HeatCapacity		=	1050
		RadioactiveHeat		=	0
		ShearHeating		=	0
	<MaterialEnd>

# End of defining material properties for all phases ----------------------------------------