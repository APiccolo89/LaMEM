# Standard falling block test

# Define number of elements in x,y & z-direction
# Negative number implies corresponding number of mesh segments
# Data is provided in the variables seg_x, seg_y, seg_z and includes:
#    * coordinates of the delimiters between the segments (n-1 points)
#    * number of cells                                    (n points)
#    * bias coefficients                                  (n points) 

nel_x						=   64    
nel_y						= 	64    
nel_z						= 	64

#nel_x						=	-3    
#nel_x						=   32    
#nel_y						= 	32    
#nel_z						= 	32

#seg_x = 0.7 0.8 10 4 2 0.3 1.0 3.0


# Geometry
DimensionalUnits		=	0			# Dimensionless (=0) or SI-dimensional units (=1)?
L						=	1			# Length (y-direction)
W						=	1			# Width  (x-direction)
H						=	1			# Height (z-direction)
x_left					=	0			# Left side of domain
y_front					=	0			# Front side of domain
z_bot					=	0			# Bottom of box

# --- Model setup and noise ---
msetup 					= block


# Define input/output and numerics-related stuff
OutputFile					=	FB_test		
save_timesteps				=	0				# save every ? timesteps
time_end					=	1				# last timestep
CFL							=	1				# CFL, dt-based criterium
dt_max						=	1e-5	  	   	# Maximum timestep [years if dimensional]
	
# Boundary conditions
BC.LeftBound				=	1				# 0 - free surface, 1-free slip with BG strainrate Eyy, 2 - no slip, 5 - growthrate 2D, 7 - growthrate 3D
BC.RightBound				=	1				# 0 - free surface, 1-free slip with BG strainrate Eyy, 2 - no slip, 5 - growthrate 2D, 7 - growthrate 3D
BC.FrontBound				=	1				# 0 - free surface, 1-free slip with BG strainrate Exx, 2 - no slip, 5 - growthrate 2D, 7 - growthrate 3D
BC.BackBound				=	1				# 0 - free surface, 1-free slip with BG strainrate Exx, 2 - no slip, 5 - growthrate 2D, 7 - growthrate 3D
BC.LowerBound				=	1				# 0 - free surface, 1-free slip, 				  2 - no slip, 5 - growthrate 2D, 7 - growthrate 3D
BC.UpperBound				=	1				# 0 - free surface, 1-free slip, 				  2 - no slip, 5 - growthrate 2D, 7 - growthrate 3D
Temp_top	    			=   0				# Temperature @ top
Temp_bottom					=   1 				# Temperature @ bottom; side BC's are flux-free



<PetscOptionsStart>
	
# SNES
	-npicard 3
	-snes_monitor
	-snes_atol 1e-12
	-snes_rtol 1e-6
	-snes_stol 1e-6
	-snes_max_it 25
	-snes_max_funcs 50000
	-snes_type 		ksponly

# Jacobian KSP
	-js_ksp_type gcr
	-js_ksp_max_it 1000
	-js_ksp_min_it 2
	-js_ksp_converged_reason
 	-js_ksp_monitor
	-js_ksp_rtol 1e-8

# Stokes Preconditioner
#	-pstokes al
#	-pstokes bf
	-pstokes mg

# Augmented Lagrangian
	-pgamma 1e3
	-al_ksp_type preonly
	-al_pc_type lu
	-al_pc_factor_mat_solver_package mumps

# Block Factorization

#	-velgmg
	
	# block upper triangular preconditioner
#	-bf_pc_type fieldsplit
#	-bf_pc_fieldsplit_type SCHUR
#	-bf_pc_fieldsplit_schur_factorization_type UPPER
	
	# velocity sove mg
#	-fieldsplit_u_ksp_type preonly
#	-fieldsplit_u_pc_type none

	# velocity solve gmres preconditioned with mg
#	-fieldsplit_u_ksp_type gmres
#	-fieldsplit_u_ksp_rtol 1e-2
#	-fieldsplit_u_ksp_max_it 3
#	-fieldsplit_u_pc_type none

	# velocity solve direct
#	-fieldsplit_u_ksp_type preonly
#	-fieldsplit_u_pc_type lu
#	-fieldsplit_u_pc_factor_mat_solver_package mumps
	
	# pressure solve is just inverse viscosity approximation to schur complement
#	-fieldsplit_p_ksp_type preonly
#	-fieldsplit_p_pc_type jacobi

# MULTIGRID

	-gmg_pc_type mg
	-gmg_pc_mg_levels 4
	-gmg_pc_mg_galerkin
	-gmg_pc_mg_type additive
	-gmg_pc_mg_cycle_type v

	-gmg_mg_levels_ksp_type richardson
#	-gmg_mg_levels_ksp_type chebyshev
#	-gmg_mg_levels_ksp_chebyshev_estimate_eigenvalues
	
	-gmg_mg_levels_ksp_richardson_scale 0.5
	-gmg_mg_levels_ksp_max_it 3
	#-gmg_mg_levels_pc_type jacobi
	#-gmg_mg_levels_pc_type chebyshev
	

# COARSE SOLVER

	-crs_ksp_type preonly
	-crs_pc_type redundant
	-crs_pc_redundant_number 1	
	-crs_redundant_pc_factor_mat_solver_package mumps


	# Fine-tune solver options here (add command-line Petsc Options)
	-use_fdstag_canonical
	-AddRandomNoiseParticles 0
	-restart 0
	-save_breakpoints 0
#	-SavePartitioning

#	-objects_dump

<PetscOptionsEnd>
    
# Phase distribution
NumPartX				=	2   # Particles/Cell in x-direction
NumPartY				=	2   # Particles/Cell in y-direction
NumPartZ				=	2	# Particles/Cell in z-direction

# Properties that are defined over the whole domain:
Gravity					=  -1;									# [m/s2] - gravitational acceleration 
PlasticityModel			=	0;									#  not implemented yet
Xi						=	0;									# [ ] - Shear heating factor - not implemented yet

# Define phase transitions for particles
num_phase_transitions			=	0				# The number of phase transitions present
LowerViscosityCutoff			=	1e-3
UpperViscosityCutoff			=	1e12

# Define material properties for all phases -------------------------------------------------

	# Define properties of matrix -----------------
	<MaterialStart>
		phase_id 			=	0
		attribute 			= 	VISCOSITY
		type 				= 	constant
#		type 				= 	power_law
		eta0       			= 	1	
		N_exp       		= 	3
		e0 					=	0.1	
	<MaterialEnd>
	<MaterialStart>
		phase_id 			= 	0
		attribute 			= 	DENSITY
		type 				= 	temperature_dependent
		rho0        		= 	1
		alpha 				=	0
	<MaterialEnd>
	<MaterialStart>
		phase_id			= 	0
		attribute 			= 	ELASTICITY
		type 				= 	constant
		shear        		= 	5e10
	<MaterialEnd>
	<MaterialStart>
		phase_id			= 	0
		attribute 			= 	ENERGY
		type 				= 	constant
		ThermalConductivity	= 	3
		HeatCapacity		=	1050
		RadioactiveHeat		=	0
		ShearHeating		=	0
	<MaterialEnd>
	<MaterialStart>
		phase_id			= 	0
		attribute 			= 	PLASTICITY
		type 				= 	constant
		Cohesion        	= 	20e60
		FrictionAngle		= 	30
	<MaterialEnd>


	# Define properties of block -------------------
	<MaterialStart>
		phase_id 			=	1
		attribute 			= 	VISCOSITY
		type 				= 	constant
#		type 				= 	power_law
		eta0       			= 	1
		N_exp       		= 	3
		e0 					=	0.1	
	<MaterialEnd>
	<MaterialStart>
		phase_id			= 	1
		attribute 			= 	DENSITY
		type 				= 	temperature_dependent
		rho0        		= 	2
		alpha 				=	0
	<MaterialEnd>
	<MaterialStart>
		phase_id			= 	1
		attribute 			= 	ELASTICITY
		type 				= 	constant
		shear        		= 	5e10
	<MaterialEnd>
	<MaterialStart>
		phase_id			= 	1
		attribute 			= 	ENERGY
		type 				= 	constant
		ThermalConductivity	= 	3
		HeatCapacity		=	1050
		RadioactiveHeat		=	0
		ShearHeating		=	0
	<MaterialEnd>
	<MaterialStart>
		phase_id			= 	1
		attribute 			= 	PLASTICITY
		type 				= 	constant
		Cohesion        	= 	20e60
		FrictionAngle		= 	30
	<MaterialEnd>
	
# End of defining material properties for all phases ----------------------------------------
