# Detachment folding setup to be used to generate a movie for GeoMod2010

# Define number of elements in x,y & z-direction (should be uneven!)
nel_x						=	16 
nel_y						= 	16 
nel_z						= 	8 			
levels					= 	4 			# number of multigrid levels

# Geometry
DimensionalUnits			=	1			# Dimensionless (=0) or SI-dimensional units (=1)?
L						=	500e3			# Length (y-direction)
W						=	500e3			# Width  (x-direction)
H						=	120e3			# Height (z-direction)
x_left					=	0			# Left side of domain
y_front					=	0			# Front side of domain
z_bot						=	-120e3		# Bottom of box

# Define model setup and noise
Setup.Model				=	3			# 0-detachment folding setup  4-multilayer folding
ampl2D					=	0.0	 		# Amplitude of 2D sinuoidal perturbtion
ampl3D					=	0.0			# Amplitude of 3D sinuoidal perturbtion
amplNoise					=	0.0	 		# Amplitude of noise @ interface

# Define input/output and numerics-related stuff
OutputFile					=	ThinSheet_Output		
save_timesteps				=	2			# save every ? timesteps
time_end					=	71			# last timestep
CFL						=	1			# CFL, dt-based criterium
dt_max					=	3e5	  		# Maximum timestep [years if dimensional]
	
# Boundary conditions
BC.Eyy					=	0e-15			# BG strainrate in y-direction
BC.Exx					=	1e-15			# BG Strainrate in x-direction
BC.LeftBound				=	6			# 0 - free surface, 1-free slip with BG strainrate Eyy, 2 - no slip, 3-periodic
BC.RightBound				=	6			# 0 - free surface, 1-free slip with BG strainrate Eyy, 2 - no slip, 3-periodic
BC.FrontBound				=	6			# 0 - free surface, 1-free slip with BG strainrate Exx, 2 - no slip, 5 - growthrate 2D, 7 - growthrate 3D
BC.BackBound				=	6			# 0 - free surface, 1-free slip with BG strainrate Exx, 2 - no slip, 5 - growthrate 2D, 7 - growthrate 3D
BC.LowerBound				=	5			# 0 - free surface, 1-free slip, 				  2 - no slip, 5 - growthrate 2D, 7 - growthrate 3D
BC.UpperBound				=	0			# 0 - free surface, 1-free slip, 				  2 - no slip, 5 - growthrate 2D, 7 - growthrate 3D
#Temp_top	    				=   	0			# Temperature @ top
#Temp_bottom				=   	1000 			# Temperature @ bottom; side BC's are flux-free

# Grid advection method
GridAdvectionMethod			= 	1 			# 0-Fully Eulerian, 1-Fully Lagrangian, 2-ALE with remeshing @ surface layer
FactorSurfaceLayer			= 	1 			# How thick is the surface layer (if option 2 is selected above) ?

# Define solver and set options for Uzawa
SolverType					=	5			# 1-Multigrid, 2-KSP, 3-Direct [serial!], 4-MUMPS
UzawaSolver 				=	1			# 1-Schur/FGMRES;  2-Old way (CG);  3-Powell Hesteness iterations
MG_Solver					=	1			# 0-default, 1-richa/bjac, 2-richa/jac, 3-richa/sor
MG_Scale					=	0.6			# Scale employed if MS_solver==1,2 or 3
SmoothUp					=   	2           	# Number of smoothing steps on finest level
SmootherMethod      			=   	0           	# 0-keep as in fine level, 1-increase steps on coarser levels 
MaximumDivergence  			=   	1e-4        	# Cutoff divergence
Uzawa_RelInnerAccuracy		=   	1e-4        	# Cutoff inner error for preconditioning step in Uzawa iterations
Uzawa_MaxInnerIterations		=   	50			# Maximum number of inner iterations
NonlinearIterationsAccuracy	= 	1e-4			# Stopping criterium for power-law loop
MaxNonlinearIterations		= 	25			# Maximum number of nonlinear iterations

<PetscOptionsStart>

# Fine-tune solver options here (add command-line Petsc Options)
	#-vpt_element Q1P0					# Type of element [Q2Pm1_global; Q2Pm1_local; Q1P0]
	-vpt_element Q1Q1					# Type of element [Q2Pm1_global; Q2Pm1_local; Q1P0]
	
	#-AddRandomNoiseParticles 1
	
	# interface between salt and overburden:
	#-Hinterface 0.5

	## Schur complement solver options:
	-schur_ksp_type fgmres
	-schur_ksp_rtol 1.0e-5
	-schur_pc_type bjacobi

	## MUMPS options

	## GMG options
	-gmg_ksp_rtol 1.0e-6
	-gmg_ksp_type fgmres
	-gmg_ksp_atol 1.0e-10

	-gmg_mg_levels_ksp_type fgmres
	-gmg_mg_levels_ksp_max_it 4
	-gmg_mg_levels_pc_type fieldsplit
	-gmg_mg_levels_pc_fieldsplit_type ADDITIVE
	-gmg_mg_levels_pc_fieldsplit_block_size 3
	-gmg_mg_levels_fieldsplit_ksp_type fgmres
	-gmg_mg_levels_fieldsplit_ksp_max_it 4
	-gmg_mg_levels_fieldsplit_pc_type bjacobi

	-gmg_mg_coarse_pc_type lu
	-gmg_mg_coarse_pc_factor_mat_solver_package superlu_dist

#        -gmg_ksp_max_it 1
#        -schur_ksp_max_it 1

	-gmg_ksp_monitor
	-gmg_ksp_converged_reason

	-schur_ksp_monitor
	-schur_ksp_converged_reason
	-schur_ksp_view
        
	-options_left 1
	-time_end 71

<PetscOptionsEnd>

# Phase distribution
ParticleInput 			=   1						# Use particles to track properties? 0-no; 1-yes
ParticleFilename		=   ParticlesInput_EGUrun.dat		# File that contains particle distribution
SaveTracers 			=   0                 			# Write particles to disk?
NumPartX				=   2						# Particles/Cell in x-direction
NumPartY				=   2						# Particles/Cell in y-direction
NumPartZ				=   2						# Particles/Cell in z-direction

# Read initial grid from file?
InitialMeshFromFile 		=   0 					# In case you want to hand-modify the initial grid
InitialMeshFileName 		=   Grid_in.dat	
InitialMantleLevel		=   0						# Set to zero to deactivate

# Properties that are defined over the whole domain:
Gravity					=	10;						# [m/s2] - gravitational acceleration 
PlasticityModel				=	0;						#  not implemented yet
Xi						=	0;						# [ ] - Shear heating factor - not implemented yet

# Define characteristic values, used if DimensionalUnits==1, otherwise ignored
Characteristic.Length			=	120e3				# [m]
Characteristic.Viscosity 		=	2.5e21			#1e20				# [Pa.s]
Characteristic.Temperature		=	1				# [K]
Characteristic.Stress      	=   	1e6				#1e5				# [Pa]

# Define phase transitions for particles
num_phase_transitions			=	0				# The number of phase transitions present

# Define material properties for all phases -------------------------------------------------
num_phases					=	4				# Total number of phases defined in code
LowerViscosityCutoff			=	1e19;
UpperViscosityCutoff			=	1e25;

	# Define properties upper crust----------------
	<MaterialStart>
		phase_id 			=	3
		attribute 			= 	VISCOSITY
		type 				= 	constant
		eta0       		= 	2e23	
		#N_exp			=	4
		#e0				=	1e-15
	<MaterialEnd>
	<MaterialStart>
		phase_id			= 	3
		attribute 			= 	DENSITY
		type 				= 	temperature_dependent
		rho0        		= 	2700
		alpha 			=	0
	<MaterialEnd>
	
	# Define properties of lower crust----------------
	<MaterialStart>
		phase_id 			=	2
		attribute 			= 	VISCOSITY
		type 				= 	constant
		eta0       		= 	2.5e21	
		#N_exp			=	4
		#e0				=	1e-15
	<MaterialEnd>
	<MaterialStart>
		phase_id			= 	2
		attribute 			= 	DENSITY
		type 				= 	temperature_dependent
		rho0        		= 	2700
		alpha 			=	0
	<MaterialEnd>

	# Define properties of upper mantle----------------
	<MaterialStart>
		phase_id 			=	1
		attribute 			= 	VISCOSITY
		type 				= 	constant
		eta0       		= 	5e23	
		#N_exp			=	4
		#e0				=	1e-15	
	<MaterialEnd>
	<MaterialStart>
		phase_id			= 	1
		attribute 			= 	DENSITY
		type 				= 	temperature_dependent
		rho0        		= 	3200
		alpha 			=	0
	<MaterialEnd>

	# Define properties of lower mantle-----------------
	<MaterialStart>
		phase_id 			=	0
		attribute 			= 	VISCOSITY
		type 				= 	constant			
		eta0       		= 	5e21	
		#N_exp			=	4
		#e0				=	1e-15	
	<MaterialEnd>
	<MaterialStart>
		phase_id 			= 	0
		attribute 			= 	DENSITY
		type 				= 	temperature_dependent
		rho0        		= 	3200
		alpha 			=	0
	<MaterialEnd>

# End of defining material properties for all phases ----------------------------------------
