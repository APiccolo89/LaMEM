
# PLEASE DON'T USE TABS ANYWERE EXCEPT THE FIRST CHARACTERS INA ROW (LOOKS UGLY)

#===============================================================================
# Scaling
#===============================================================================

	units = geo

	unit_temperature = 1.0
	unit_length      = 1e3
	unit_viscosity   = 1e18
	unit_stress      = 1e6

# units = none - input & output is non-dimensional
# units = si   - input & output is in SI units
# units = geo  - input & output is in SI units, except:
#
#    time        - Myr
#    length      - km
#    velocity    - cm/yr
#    stress      - MPa
#    heat_flux   - mW/m^2
#    Temperature - C
#
# NOTE:
#
# * characteristic values must ALWAYS be provided in SI units
# * material parameters must ALWAYS be provided in SI units
# * in all dimensional cases (si & geo) angles are measured in degrees
#   angular velocities are measured in degrees per unit time
# * number of primary units is one more than usual
#   Newton's 2nd law can be violated for quasi-static problems
#   If density is not provided, Newton's 2nd law is enforced

#===============================================================================
# Time stepping parameters
#===============================================================================

	dt        = 0.0005  # time step
	dt_min    = 0.0000001  # minimum time step (declare divergence if lower value is attempted)
        dt_max = 1.0
	CFL       = 0.5   # CFL (Courant-Friedrichs-Lewy) criterion
	CFLMAX    = 0.8   # CFL criterion for elasticity
	nstep_max = 200    # maximum allowed number of steps (lower bound: time_end/dt_max)
	nstep_out = 10     # save output every n steps
	nstep_rdb = 5     # save restart database every n steps
	time_tol  = 1e-8  # relative tolerance for time comparisons

#===============================================================================
# Grid & discretization parameters
#===============================================================================

# relative geometry tolerance for grid manipuations (default 1e-6)

	gtol = 1e-7

# Number of processes
# If not provided, calculated internally
# If all values are provided they must be a factorization of number MPI processes
# Use this if you really know what you are doing (this is fine tuning)

# Number of cells for all segments

	nel_x = 64
	nel_y = 2
	nel_z = 64

# Coordinates of all segments (including start and end points)

	coord_x = -500 500
	coord_y = -2.0 2.0
	coord_z = -1000 40

# Bias ratios for all segments (default is 1.0 - uniform grid)
# Bias ratio is the size in the END divided by the size in the BEGINNING
# It is LESS than unit for DECREASING cell size
# It is MORE than unit for INCREASING cell size



# EXAMPLE:
# segment 1: [0, 0.7),  10 cells, decreasing spacing  (sz.end/ sz.beg = 0.3)
# segment 2: [0.7 0.8), 4 cells,  uniform spacing
# segment 3: [0.8 1.0], 2 cells,  increasing spacing  (sz.end/ sz.beg = 3.0)

#===============================================================================
# Free surface
#===============================================================================

	surf_use        = 1                   # free surface activation flag
	surf_level      = 0                   # initial level
	surf_air_phase  = 0                   # phase ID of sticky air layer
	surf_max_angle     = 35.0             # maximum angle with horizon (smoothed if larger)
	surf_no_shift_mark = 1                # deactivate shifting markers at the free surface.
#===============================================================================
# Boundary conditions
#===============================================================================

# Default conditions on all the boundaries:
# * (mechanical): free-slip with zero normal velocity
# * (thermal)   : zero heat flux

# Background strain rate parameters

# Bezier blocks (single entry per block)

	
	
# Free surface top boundary flag

	open_top_bound = 1

# No-slip boundary flag mask (left right front back bottom top)

	noslip = 0 0 0 0 0 0

# 
	
# temperature on the top & bottom boundaries

	temp_top  = 20.0
	temp_bot  = 1600.0;


	
#===============================================================================
# Solution parameters & controls
#===============================================================================

	gravity         = 0.0 0.0 -10.0  # gravity vector
	FSSA            = 1.0            # free surface stabilization parameter [0 - 1]
	shear_heat_eff  = 1.0            # shear heating efficiency parameter   [0 - 1]
	Adiabatic_Heat  = 1.0           # Adiabatic Heating activaction flag and efficiency. [0.0 - 1.0] (e.g. 0.5 means that only 50% of the potential adiabatic heating affects the energy equation)   
	act_temp_diff   = 1              # temperature diffusion activation flag
	#act_therm_exp   = 1              # thermal expansion activation flag
	#act_steady_temp = 1              # steady-state temperature initial guess activation flag
	#steady_temp_t   = 0.0            # time for (quasi-)steady-state temperature initial guess
	nstep_steady    = 0              # number of steps for (quasi-)steady-state temperature initial guess (default = 1)
	act_p_shift     = 1              # pressure shift activation flag (zero pressure in the top cell layer)
	init_lith_pres  = 1              # initial pressure with lithostatic pressure (stabilizes compressible setups in the first steps)
	init_guess      = 1              # initial guess flag
	p_litho_visc    = 0              # use lithostatic pressure for creep laws
	p_litho_plast   = 0              # use lithostatic pressure for plasticity
	p_lim_plast     = 1              # limit pressure at first iteration for plasticity
	eta_min         = 1e18           # viscosity lower bound
	eta_max         = 1e24           # viscosity upper limit
	eta_ref         = 1e20           # reference viscosity (initial guess)
	#T_ref           = 20.0           # reference temperature
	#RUGC            = 8.31           # universal gas constant (required only for non-dimensional setups)
	DII_ref         = 1e-15          # background (reference) strain-rate
	#min_cohes       = 2e7            # cohesion lower bound
	#min_fric        = 5.0            # friction lower bound
	#tau_ult         = 1e9            # ultimate yield stress
	quasi_harm_avg  = 1              # quasi-harmonic averaging regularization flag (plasticity)
	#rho_fluid       = 1e3            # fluid density for depth-dependent density model
	#gw_level_type   = top            # ground water level type for pore pressure computation (see below)
	#gw_level        = 10.0           # ground water level at the free surface (if defined)
	#biot            = 0.7            # Biot pressure parameer
	#get_permea      = 1              # effective permeability computation activation flag
	#rescal          = 1              # stensil rescaling flag (for internal constraints)
	Passive_Tracers = 1
	melt_feedback   = 1
# Groundwater level type specification:

# gw_level_type = none  # don't compute pore pressure (default)
# gw_level_type = top   # GW level is top of the domain
# gw_level_type = surf  # GW level is free surface average level (surface must be enabled)
# gw_level_type = level # GW level is fixed (gw_level parameter must be specified)

#===============================================================================
# Solver options
#===============================================================================
	SolverType 			=	direct 		# solver [direct or multigrid]
	DirectSolver 		=	mumps		# mumps/superlu_dist/pastix	
	DirectPenalty 		=	1e3			# penalty parameter [employed if we use a direct solver]
	
#===============================================================================
# Model setup & advection
#===============================================================================

	msetup          = geom              # setup type
	nmark_x         = 2                 # markers per cell in x-direction
	nmark_y         = 2                 # ...                 y-direction
	nmark_z         = 2                 # ...                 z-direction
	rand_noise      = 0                 # random noise flag
	rand_noiseGP    = 0                 # random noise flag, subsequently applied to geometric primitives
	bg_phase        = 0                 # background phase ID
	save_mark       = 1                 # save marker to disk flag
	advect          = basic             # advection scheme
	interp          = stag             # velocity interpolation scheme
	stagp_a         = 0.7               # STAG_P velocity interpolation parameter
	mark_ctrl       = subgrid              # marker control type
	nmark_sub       = 2                 # max number of same phase markers per subcell (subgrid marker control)
	coordinate_box_passive_tracers = -500 500 -2 2 -230 0
	passive_tracer_resolution      = 50 1 50 

# Advection types:

#	advect = none  # no advection (no markers)
#	advect = basic # basic (Euler classic implementation)
#	advect = euler # Euler explicit in time
#	advect = rk2   # Runge-Kutta 2nd order in space

# Velocity interpolation types (only for euler & rk2):

#	interp = stag   # trilinear interpolation from FDSTAG points
#	interp = minmod # MINMOD interpolation to nodes, trilinear interpolation to markers + correction
#	interp = stagp  # STAG_P empirical approach (T. Gerya)

# Setup type specification:

#	msetup = geom     # default input (phases are assigned from geometric primitives)
#	msetup = files    # MATLAB input (requires mark_load_path and mark_load_name parameters)
#	msetup = polygons # geomIO input (requires poly_file parameter)

# Marker control type specification:

#	mark_ctrl = none    # no marker control
#	mark_ctrl = basic   # AVD for cells + corner insertion
#	mark_ctrl = avd     # pure AVD for all control volumes
#	mark_ctrl = subgrid # simple marker control enforced over fine scale grid

# Geometric primitives:







	<LayerStart>
		phase       = 1
		top         = 0
		bottom      = -1000
		Temperature = halfspace # optional: Temperature structure. possibilities: [constant, linear, halfspace]
		topTemp     = 20         # required in case of [linear,halfspace]: temperature @ top [in Celcius in case of GEO units]
		botTemp     = 1500      # required in case of [linear,halfspace]: temperature @ bottom [in Celcius in case of GEO units]
		thermalAge  = 30        # required in case of [halfspace]: thermal age of lithosphere [in Myrs if GEO units are used]
	<LayerEnd>


	<LayerStart>
		phase       = 10
		top         = 0
		bottom      = -40
		Temperature = constant # optional: Temperature structure. possibilities: [constant, linear, halfspace]
		cstTemp     = 300      # required in case of [constant]: temperature value [in Celcius in case of GEO units]
	<LayerEnd>
	

	<SphereStart>
		phase       = 1
		radius      = 120
		center      = 0.0 0.0 -200
		Temperature = constant # optional: Temperature of the sphere. possibilities: [constant]
		cstTemp     = 500     # required in case of [constant]: temperature value [in Celcius in case of GEO units]
	<SphereEnd>
#===============================================================================
# Output
#===============================================================================

# Grid output options (output is always active)

	out_file_name       = output # output file name
	out_pvd             = 1      # activate writing .pvd file
	out_phase           = 1
	out_density         = 1
	out_visc_total      = 1
	out_visc_creep      = 1
	out_visc_plast      = 1
	out_velocity        = 1
	out_pressure        = 1
	out_eff_press       = 1
	out_over_press      = 1
	out_litho_press     = 1
	out_pore_press      = 1
	out_temperature     = 1
	out_dev_stress      = 1
	out_j2_dev_stress   = 1
	out_strain_rate     = 1
	out_j2_strain_rate  = 1
	out_shmax           = 1
	out_ehmax           = 1
	out_isa             = 1
	out_gol             = 1
	out_yield           = 1
	out_rel_diff_rate   = 1
	out_plast_strain    = 1
	out_plast_dissip    = 1
	out_tot_displ       = 1
	out_moment_res      = 1
	out_cont_res        = 1
	out_energ_res       = 1
	out_melt_fraction   = 1
# Phase aggregate output paramter
# Phase ratios of listed phases are summed up and output as a scalar vector
# Phase aggregate can consist of a single phase


# Free surface output options (can be activated only if surface tracking is enabled)

	out_surf            = 1 # activate surface output
	out_surf_pvd        = 1 # activate writing .pvd file
	out_surf_velocity   = 1
	out_surf_topography = 1
	out_surf_amplitude  = 1

# Marker output options (requires activation)

	out_mark     = 1 # activate marker output
	out_mark_pvd = 1 # activate writing .pvd file

# AVD phase viewer output options (requires activation)

	out_avd     = 1 # activate AVD phase output
	out_avd_pvd = 1 # activate writing .pvd file
	out_avd_ref = 3 # AVD grid refinement factor

#===============================================================================
# Material phase parameters
#===============================================================================
	########Lithosphere_Phase_transition


	

# Define material properties for all phases (maximum 32)
# By default all rheological mechanisms are deactivated
# List only active parameters in the material data block

	<MaterialStart>
		ID        = 0
		rho       = 1e2
		eta       = 1e18
		k         = 5
		Cp        = 1e6
		G         = 4000e10
		ch        = 1e9
		fr        = 30
	<MaterialEnd>
	###########################################################################################
	# Mantle -Astenosphere - Phases
	############################################################################################
	
	
	# Mantle Astenosphere
	<MaterialStart>
		ID        = 1      # material phase ID
		G         = 4e10
		ch        = 1e7
		disl_prof 	= 	Dry_Olivine_disl_creep-Hirth_Kohlstedt_2003
		diff_prof 	=	Dry_Olivine_diff_creep-Hirth_Kohlstedt_2003
	        fr              = 30
		rho       = 3300    # reference density
		beta      = 1e-11  # pressure-dependent density model parameter
		
		alpha     = 3e-5   # thermal expansivity
		Cp        = 1.0e3  # specific heat (capacity)
		k         = 3.0    # thermal conductivity
		A         = 0.33e-11   # radiogenic heat production
		Melt_Parametrization = Katz_2003
		rho_melt  = 2900

	<MaterialEnd>
	# Enriched Mantle 
	<MaterialStart>
		ID        = 2      # material phase ID
		rho       = 3250    # reference density
		G         = 4e10
		ch        = 1e7
		disl_prof 	= 	Dry_Olivine_disl_creep-Hirth_Kohlstedt_2003
		diff_prof 	=	Dry_Olivine_diff_creep-Hirth_Kohlstedt_2003
	        fr              = 30
		beta      = 1e-11  # pressure-dependent density model parameter
		alpha     = 3e-5   # thermal expansivity
		Cp        = 1.0e3  # specific heat (capacity)
		k         = 3.0    # thermal conductivity
		A         = 2e-11   # radiogenic heat production
	<MaterialEnd>
	
	#######################################################################
	# Lithosphere
	#######################################################################
	
	<MaterialStart>
		ID        = 3      # material phase ID
		G         = 4e10
		ch        = 1e7
		disl_prof 	= 	Dry_Olivine_disl_creep-Hirth_Kohlstedt_2003
		diff_prof 	=	Dry_Olivine_diff_creep-Hirth_Kohlstedt_2003
	        fr              = 30
		rho       = 3300    # reference density
		beta      = 1e-11  # pressure-dependent density model parameter
		
		alpha     = 3e-5   # thermal expansivity
		Cp        = 1.0e3  # specific heat (capacity)
		k         = 3.0    # thermal conductivity
		A         = 0.33e-11   # radiogenic heat production
		Melt_Parametrization = Katz_2003
		rho_melt  = 2900
	<MaterialEnd>
	##########################################################################
	# Lower Mantle 
	##########################################################################
	
	<MaterialStart>
		ID        = 4      # material phase ID
		G         = 4e10
		ch        = 1e7
		disl_prof 	= 	Dry_Olivine_disl_creep-Hirth_Kohlstedt_2003
		diff_prof 	=	Dry_Olivine_diff_creep-Hirth_Kohlstedt_2003
	        fr              = 30
		rho       = 3500    # reference density
		beta      = 1e-11  # pressure-dependent density model parameter
		
		alpha     = 3e-5   # thermal expansivity
		Cp        = 1.0e3  # specific heat (capacity)
		k         = 3.0    # thermal conductivity
		A         = 0.33e-11   # radiogenic heat production
	<MaterialEnd>
	# Enriched Mantle 
	<MaterialStart>
		ID        = 5      # material phase ID
		G         = 4e10
		ch        = 1e7
		disl_prof 	= 	Dry_Olivine_disl_creep-Hirth_Kohlstedt_2003
		diff_prof 	=	Dry_Olivine_diff_creep-Hirth_Kohlstedt_2003
	        fr              = 30
		rho       = 3500    # reference density
		beta      = 1e-11  # pressure-dependent density model parameter
		alpha     = 3e-5   # thermal expansivity
		Cp        = 1.0e3  # specific heat (capacity)
		k         = 3.0    # thermal conductivity
		A         = 2e-11   # radiogenic heat production
	<MaterialEnd>

	##################################################################################
	# Lower Mantle Lithosphere
	###################################################################################

	<MaterialStart>
		ID        = 6      # material phase ID
		G         = 4e10
		ch        = 1e7
		disl_prof 	= 	Dry_Olivine_disl_creep-Hirth_Kohlstedt_2003
		diff_prof 	=	Dry_Olivine_diff_creep-Hirth_Kohlstedt_2003
	        fr              = 30
		rho       = 3500    # reference density
		beta      = 1e-11  # pressure-dependent density model parameter
		
		alpha     = 3e-5   # thermal expansivity
		Cp        = 1.0e3  # specific heat (capacity)
		k         = 3.0    # thermal conductivity
		A         = 0.33e-11   # radiogenic heat production
	<MaterialEnd>
	
	<MaterialStart>
		ID        = 7      # material phase ID
		G         = 4e10
		ch        = 1e7
		disl_prof 	= 	Dry_Olivine_disl_creep-Hirth_Kohlstedt_2003
		diff_prof 	=	Dry_Olivine_diff_creep-Hirth_Kohlstedt_2003
	        fr              = 30
		rho       = 3500    # reference density
		beta      = 1e-11  # pressure-dependent density model parameter
		
		alpha     = 3e-5   # thermal expansivity
		Cp        = 1.0e3  # specific heat (capacity)
		k         = 3.0    # thermal conductivity
		A         = 0.33e-11   # radiogenic heat production
	<MaterialEnd>
	# Enriched Mantle 
	<MaterialStart>
		ID        = 8      # material phase ID
		G         = 4e10
		ch        = 1e7
		disl_prof 	= 	Dry_Olivine_disl_creep-Hirth_Kohlstedt_2003
		diff_prof 	=	Dry_Olivine_diff_creep-Hirth_Kohlstedt_2003
	        fr              = 30
		rho       = 3500    # reference density
		beta      = 1e-11  # pressure-dependent density model parameter
		alpha     = 3e-5   # thermal expansivity
		Cp        = 1.0e3  # specific heat (capacity)
		k         = 3.0    # thermal conductivity
		A         = 2e-11   # radiogenic heat production
	<MaterialEnd>

	##################################################################################
	# Lower Mantle Lithosphere
	###################################################################################

	<MaterialStart>
		ID        = 9      # material phase ID
		G         = 4e10
		ch        = 1e7
		disl_prof 	= 	Dry_Olivine_disl_creep-Hirth_Kohlstedt_2003
		diff_prof 	=	Dry_Olivine_diff_creep-Hirth_Kohlstedt_2003
	        fr              = 30
		rho       = 3500    # reference density
		beta      = 1e-11  # pressure-dependent density model parameter
		
		alpha     = 3e-5   # thermal expansivity
		Cp        = 1.0e3  # specific heat (capacity)
		k         = 3.0    # thermal conductivity
		A         = 0.33e-11   # radiogenic heat production
	<MaterialEnd>
	###################################################################################
	# Crust
	##################################################################################
	
	# Mafic Crust
	<MaterialStart>
		ID        = 10      # material phase ID
		disl_prof = Wet_Quarzite-Ranalli_1995                   # DISLOCATION creep profile
		rho       = 3000    # reference density
		beta      = 1e-11  # pressure-dependent density model parameter
		alpha     = 3e-5   # thermal expansivity
		Cp        = 1.2e3  # specific heat (capacity)
		k         = 3.0    # thermal conductivity
		A         = 2e-10   # radiogenic heat production
		G         = 4e10
		ch        = 1e7
	        fr              = 30
	<MaterialEnd>
	<MaterialStart>
		ID        = 11     # material phase ID
		disl_prof = Wet_Quarzite-Ranalli_1995                   # DISLOCATION creep profile
		rho       = 3400    # reference density
		beta      = 1e-11  # pressure-dependent density model parameter
		alpha     = 3e-5   # thermal expansivity
		Cp        = 1.2e3  # specific heat (capacity)
		k         = 3.0    # thermal conductivity
		A         = 2e-10   # radiogenic heat production
		G         = 4e10
		ch        = 1e7
	        fr              = 30
	<MaterialEnd>
	
#===============================================================================
# PETSc options
#===============================================================================

		<PetscOptionsStart>

# SNES

	-snes_npicard 2
	-snes_monitor
	-snes_atol 1e-4
	-snes_rtol 1e-4
	-snes_stol 1e-50
	-snes_max_it 30
#	-snes_max_funcs 50000
#	-snes_type ksponly  
	-snes_PicardSwitchToNewton_rtol 1e-4
#	-snes_linesearch_type l2
	-res_log
#
## Jacobian solver
#
	-js_ksp_type fgmres
	-js_ksp_max_it 30
	-js_ksp_converged_reason
 	-js_ksp_monitor
	-js_ksp_rtol 1e-6

# Preconditioner

#	-pcmat_type block
#	-pcmat_pgamma 1e3
#	-jp_type bf
#	-bf_vs_type user
#	-vs_ksp_type preonly
#	-vs_pc_type lu
#	-vs_pc_factor_mat_solver_package mumps

#	-pcmat_type block
#	-pcmat_no_dev_proj
#	-jp_type bf
#	-bf_vs_type mg
#	-vs_ksp_type preonly

	#-pcmat_type mono
	#-jp_type mg

#	-gmg_pc_view
#	-gmg_dump
	#-gmg_pc_type mg
	#-gmg_pc_mg_levels 4
	#-gmg_pc_mg_galerkin
	#-gmg_pc_mg_type multiplicative
	#-gmg_pc_mg_cycle_type v

	#-gmg_mg_levels_ksp_type richardson
	#-gmg_mg_levels_ksp_richardson_scale 0.5
	#-gmg_mg_levels_ksp_max_it 20
	#-gmg_mg_levels_pc_type jacobi

	#-crs_ksp_type preonly
	#-crs_pc_type lu
	#-crs_pc_factor_mat_solver_package mumps

	#-objects_dump

<PetscOptionsEnd>

#===============================================================================
