function [q_dom, q, Vel,Ampl_Time,Time_vec, Vel_Erosion_Time] =        ...
    Biot_nlayer_powerlaw_time(lambda,ninterface,mu ,n_vec, gam_vec, rho_vec, g, Ampl,H_int,...
    lower_bound,upper_bound, str_bg, Ampl_max, k, Ind_interface)
%
% Thick plate stability analysis for folding and RT instability for
% multilayer cases with
%    (1) constant powerlaw  viscosity
%
% Currently implemented BC:
%       Upper:  free slip, no slip, free surface, fast erosion
%       Lower:  free slip, no slip
%
% Boris Kaus, ETH, April 2007, based on a previous script from Jan. 06
%  Re-derived, october 2007, using a different powerlaw solution by
%  Fletcher & Hallett

% Construct stiffness matrix
neq         =   4*(ninterface-1);   %   number of equations
M           =   zeros(neq,neq);
RHS         =   zeros(neq,1);
P           =   zeros(neq,ninterface);
Q           =   zeros(ninterface,neq);
omega       =   2*pi/lambda;

% Define middle interfaces
for ilay=1:ninterface

    %
    % Construct small stiffness matrix
    %

    if (ilay>1 & ilay<ninterface) % For middle interfaces

        for i=1:2
            if (i==1)
                % Upper layer
                rho         =   rho_vec(ilay-1  );
                Hi          =   H_int  (ilay  );
                mu0         =   mu     (ilay-1  );
                n           =   n_vec  (ilay-1  );
                gam         =   gam_vec(ilay-1  );
                z           =   Hi;
                z0          =   H_int  (ilay-1  );  % reference value for T-dependent viscosity:  mu=mu0*exp(gamma*(z-z0))

                if (n==1); n=1.0000001; end

                Method = 'PowerlawConstant';


            else
                % Lower layer
                rho         =   rho_vec(ilay  );
                Hi          =   H_int  (ilay  );
                mu0         =   mu     (ilay  );
                n           =   n_vec  (ilay  );
                gam         =   gam_vec(ilay  );
                z           =   Hi;
                z0          =   H_int  (ilay-1  );  % reference value for T-dependent viscosity:  mu=mu0*exp(gamma*(z-z0))

                if (n==1); n=1.0000001; end

            end

            % Local coefficients for internal interfaces
            % In case we have constant props with depth:
            M_local = [[2/n^(1/2)*mu0*omega*exp(1/n^(1/2)*omega*z)*cos((n-1)^(1/2)/n^(1/2)*omega*z), 2/n^(1/2)*mu0*omega*exp(1/n^(1/2)*omega*z)*sin((n-1)^(1/2)/n^(1/2)*omega*z), -2/n^(1/2)*mu0*omega*exp(-1/n^(1/2)*omega*z)*cos((n-1)^(1/2)/n^(1/2)*omega*z), -2/n^(1/2)*mu0*omega*exp(-1/n^(1/2)*omega*z)*sin((n-1)^(1/2)/n^(1/2)*omega*z)];...
                [2*mu0*omega/n*exp(1/n^(1/2)*omega*z)*((n-1)^(1/2)*sin((n-1)^(1/2)/n^(1/2)*omega*z)-cos((n-1)^(1/2)/n^(1/2)*omega*z)), -2*mu0*omega/n*exp(1/n^(1/2)*omega*z)*((n-1)^(1/2)*cos((n-1)^(1/2)/n^(1/2)*omega*z)+sin((n-1)^(1/2)/n^(1/2)*omega*z)), -2*mu0*omega/n*exp(-1/n^(1/2)*omega*z)*((n-1)^(1/2)*sin((n-1)^(1/2)/n^(1/2)*omega*z)+cos((n-1)^(1/2)/n^(1/2)*omega*z)), -2*mu0*omega/n*exp(-1/n^(1/2)*omega*z)*(-(n-1)^(1/2)*cos((n-1)^(1/2)/n^(1/2)*omega*z)+sin((n-1)^(1/2)/n^(1/2)*omega*z))];...
                [cos((n-1)^(1/2)/n^(1/2)*omega*z)*exp(1/n^(1/2)*omega*z), sin((n-1)^(1/2)/n^(1/2)*omega*z)*exp(1/n^(1/2)*omega*z), exp(-1/n^(1/2)*omega*z)*cos((n-1)^(1/2)/n^(1/2)*omega*z), exp(-1/n^(1/2)*omega*z)*sin((n-1)^(1/2)/n^(1/2)*omega*z)];...
                [1/n^(1/2)*exp(1/n^(1/2)*omega*z)*((n-1)^(1/2)*sin((n-1)^(1/2)/n^(1/2)*omega*z)-cos((n-1)^(1/2)/n^(1/2)*omega*z)), -1/n^(1/2)*exp(1/n^(1/2)*omega*z)*((n-1)^(1/2)*cos((n-1)^(1/2)/n^(1/2)*omega*z)+sin((n-1)^(1/2)/n^(1/2)*omega*z)), 1/n^(1/2)*exp(-1/n^(1/2)*omega*z)*((n-1)^(1/2)*sin((n-1)^(1/2)/n^(1/2)*omega*z)+cos((n-1)^(1/2)/n^(1/2)*omega*z)), 1/n^(1/2)*exp(-1/n^(1/2)*omega*z)*(-(n-1)^(1/2)*cos((n-1)^(1/2)/n^(1/2)*omega*z)+sin((n-1)^(1/2)/n^(1/2)*omega*z))]];

            %                       % Exponential depth-dependent viscosity is more tricky and does not function fully yet
            %                       M_local(1,1) = -((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*mu0*exp(1/4*(2*gam*n*z-4*gam*n*z0+z*2^(1/2)*n^(1/2)*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega)/n)*(-80*n^(1/2)*omega^4*((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*gam^2-128*omega^6*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*2^(1/2)*n^(1/2)-2*2^(1/2)*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*gam^6*n^(7/2)-32*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*2^(1/2)*omega^6*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)+64*omega^5*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*gam-2*2^(1/2)*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*gam^6*n^(5/2)-((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*gam^4*omega^2*n^2*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)+32*gam*n^3*omega^5*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)-160*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*2^(1/2)*n^(1/2)*omega^4*gam^2+2*gam^5*n^3*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*omega+4*((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*gam^2*omega^4*n^2*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)-2*2^(1/2)*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*omega^2*gam^4*n^2*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)+32*((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*omega^5*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*gam+48*n^(3/2)*omega^4*((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*gam^2+32*omega^6*((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*n*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)-32*omega^4*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*2^(1/2)*gam^2*n^(7/2)-20*gam^4*n^(3/2)*((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*omega^2-((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*gam^6*n^(5/2)-128*n^(3/2)*omega^6*((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)-96*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*2^(1/2)*n^(3/2)*omega^4*gam^2+8*gam*omega^5*n^(1/2)*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)-2*2^(1/2)*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*omega^2*gam^4*n^3*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)+8*omega^5*n^(3/2)*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*gam*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)-40*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*2^(1/2)*omega^2*gam^4*n^(3/2)+64*omega^6*((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*n^(5/2)-16*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*2^(1/2)*omega^4*gam^2*n^2*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)-8*omega^5*n^(5/2)*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*gam*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)+gam^5*omega*n^2*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)-4*gam*omega^5*n^(3/2)*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)+16*gam*omega^5*n^2*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)+gam^3*omega^3*n^(3/2)*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)-32*gam*n^2*omega^5*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)+32*omega^3*n^2*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*gam^3*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)+16*gam^3*omega^3*n*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)-32*((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*omega^5*n*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*gam-16*((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)*omega^6*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*n^2*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)+16*omega^5*n^(1/2)*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*gam*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)-16*omega^6*((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)+64*n^(1/2)*omega^6*((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)-24*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*2^(1/2)*omega^4*gam^2*n*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)+2*omega^3*n^(3/2)*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*gam^3*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)+8*omega^4*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*2^(1/2)*n^3*gam^2*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)+32*omega^3*n*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*gam^3*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)-12*((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*gam^2*omega^4*n*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)+64*omega^4*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*2^(1/2)*gam^2*n^(5/2)+2*omega^3*n^(5/2)*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*gam^3*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)+2*gam^5*n^2*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*omega-40*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*2^(1/2)*omega^2*gam^4*n^(5/2))/n/(gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)^3;
            %                       M_local(1,2) = (-2*2^(1/2)*gam^6*n^(7/2)*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)+8*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*2^(1/2)*n^3*omega^4*gam^2*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)+2*gam^5*n^2*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*omega+16*((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)*omega^6*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*n^2*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)+8*omega^5*n^(3/2)*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*gam*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)-64*omega^6*((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*n^(5/2)-8*gam*omega^5*n^(1/2)*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)-2*2^(1/2)*gam^4*n^3*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*omega^2*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)-16*omega^4*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*2^(1/2)*gam^2*n^2*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)+16*((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)*omega^6*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)+32*omega^3*n^2*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*gam^3*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)+64*omega^4*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*2^(1/2)*n^(5/2)*gam^2+32*gam*n^3*omega^5*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)-4*((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*gam^2*omega^4*n^2*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)-32*omega^4*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*2^(1/2)*n^(7/2)*gam^2+32*((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*omega^5*n*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*gam+64*omega^5*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*gam-16*gam^3*omega^3*n*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)-160*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*2^(1/2)*n^(1/2)*omega^4*gam^2-gam^5*omega*n^2*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)-gam^3*omega^3*n^(3/2)*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)-96*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*2^(1/2)*n^(3/2)*omega^4*gam^2-8*gam*n^(5/2)*omega^5*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)-32*omega^6*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*2^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)-64*n^(1/2)*omega^6*((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)+((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*gam^6*n^(5/2)+20*gam^4*n^(3/2)*((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*omega^2-2*2^(1/2)*gam^4*n^2*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*omega^2*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)-32*((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*omega^5*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*gam-32*gam*n^2*omega^5*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)+2*gam^3*n^(3/2)*omega^3*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)+4*gam*omega^5*n^(3/2)*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)+80*n^(1/2)*omega^4*((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*gam^2+12*((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*gam^2*omega^4*n*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)+128*n^(3/2)*omega^6*((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)-24*omega^4*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*2^(1/2)*gam^2*n*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)+2*gam^3*n^(5/2)*omega^3*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)-16*gam*omega^5*n^2*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)-48*n^(3/2)*omega^4*((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*gam^2+16*omega^5*n^(1/2)*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*gam*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)-40*omega^2*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*2^(1/2)*n^(5/2)*gam^4+((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*gam^4*omega^2*n^2*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)+2*gam^5*n^3*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*omega-32*((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)*omega^6*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*n*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)+32*omega^3*n*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*gam^3*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)-40*omega^2*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*2^(1/2)*n^(3/2)*gam^4-2*2^(1/2)*gam^6*n^(5/2)*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)-128*omega^6*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*2^(1/2)*n^(1/2))*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*mu0*exp(1/4*(2*gam*n*z-4*gam*n*z0+z*2^(1/2)*n^(1/2)*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega)/n)/n/(-gam^2*n-8*omega^2+4*omega^2*n-n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)^3;
            %                       M_local(1,3) = -((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*mu0*exp(-1/4*(-2*gam*n*z+4*gam*n*z0+z*2^(1/2)*n^(1/2)*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega)/n)*(-80*n^(1/2)*omega^4*((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*gam^2+128*omega^6*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*2^(1/2)*n^(1/2)+2*2^(1/2)*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*gam^6*n^(7/2)+32*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*2^(1/2)*omega^6*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)+64*omega^5*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*gam+2*2^(1/2)*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*gam^6*n^(5/2)-((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*gam^4*omega^2*n^2*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)+32*gam*n^3*omega^5*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)+160*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*2^(1/2)*n^(1/2)*omega^4*gam^2+2*gam^5*n^3*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*omega+4*((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*gam^2*omega^4*n^2*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)+2*2^(1/2)*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*omega^2*gam^4*n^2*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)-32*((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*omega^5*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*gam+48*n^(3/2)*omega^4*((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*gam^2+32*omega^6*((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*n*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)+32*omega^4*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*2^(1/2)*gam^2*n^(7/2)-20*gam^4*n^(3/2)*((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*omega^2-((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*gam^6*n^(5/2)-128*n^(3/2)*omega^6*((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)+96*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*2^(1/2)*n^(3/2)*omega^4*gam^2-8*gam*omega^5*n^(1/2)*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)+2*2^(1/2)*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*omega^2*gam^4*n^3*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)+8*omega^5*n^(3/2)*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*gam*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)+40*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*2^(1/2)*omega^2*gam^4*n^(3/2)+64*omega^6*((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*n^(5/2)+16*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*2^(1/2)*omega^4*gam^2*n^2*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)-8*omega^5*n^(5/2)*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*gam*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)-gam^5*omega*n^2*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)+4*gam*omega^5*n^(3/2)*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)-16*gam*omega^5*n^2*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)-gam^3*omega^3*n^(3/2)*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)-32*gam*n^2*omega^5*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)+32*omega^3*n^2*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*gam^3*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)-16*gam^3*omega^3*n*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)+32*((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*omega^5*n*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*gam-16*((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)*omega^6*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*n^2*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)+16*omega^5*n^(1/2)*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*gam*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)-16*omega^6*((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)+64*n^(1/2)*omega^6*((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)+24*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*2^(1/2)*omega^4*gam^2*n*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)+2*omega^3*n^(3/2)*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*gam^3*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)-8*omega^4*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*2^(1/2)*n^3*gam^2*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)+32*omega^3*n*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*gam^3*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)-12*((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*gam^2*omega^4*n*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)-64*omega^4*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*2^(1/2)*gam^2*n^(5/2)+2*omega^3*n^(5/2)*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*gam^3*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)+2*gam^5*n^2*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*omega+40*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*2^(1/2)*omega^2*gam^4*n^(5/2))/n/(gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)^3;
            %                       M_local(1,4) = -(2*2^(1/2)*gam^6*n^(7/2)*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)-8*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*2^(1/2)*n^3*omega^4*gam^2*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)+2*gam^5*n^2*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*omega+16*((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)*omega^6*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*n^2*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)+8*omega^5*n^(3/2)*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*gam*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)-64*omega^6*((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*n^(5/2)+8*gam*omega^5*n^(1/2)*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)+2*2^(1/2)*gam^4*n^3*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*omega^2*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)+16*omega^4*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*2^(1/2)*gam^2*n^2*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)+16*((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)*omega^6*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)+32*omega^3*n^2*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*gam^3*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)-64*omega^4*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*2^(1/2)*n^(5/2)*gam^2+32*gam*n^3*omega^5*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)-4*((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*gam^2*omega^4*n^2*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)+32*omega^4*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*2^(1/2)*n^(7/2)*gam^2-32*((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*omega^5*n*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*gam+64*omega^5*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*gam+16*gam^3*omega^3*n*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)+160*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*2^(1/2)*n^(1/2)*omega^4*gam^2+gam^5*omega*n^2*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)+gam^3*omega^3*n^(3/2)*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)+96*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*2^(1/2)*n^(3/2)*omega^4*gam^2-8*gam*n^(5/2)*omega^5*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)+32*omega^6*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*2^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)-64*n^(1/2)*omega^6*((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)+((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*gam^6*n^(5/2)+20*gam^4*n^(3/2)*((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*omega^2+2*2^(1/2)*gam^4*n^2*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*omega^2*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)+32*((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*omega^5*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*gam-32*gam*n^2*omega^5*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)+2*gam^3*n^(3/2)*omega^3*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)-4*gam*omega^5*n^(3/2)*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)+80*n^(1/2)*omega^4*((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*gam^2+12*((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*gam^2*omega^4*n*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)+128*n^(3/2)*omega^6*((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)+24*omega^4*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*2^(1/2)*gam^2*n*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)+2*gam^3*n^(5/2)*omega^3*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)+16*gam*omega^5*n^2*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)-48*n^(3/2)*omega^4*((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*gam^2+16*omega^5*n^(1/2)*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*gam*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)+40*omega^2*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*2^(1/2)*n^(5/2)*gam^4+((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*gam^4*omega^2*n^2*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)+2*gam^5*n^3*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*omega-32*((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)*omega^6*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*n*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)+32*omega^3*n*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*gam^3*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)+40*omega^2*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*2^(1/2)*n^(3/2)*gam^4+2*2^(1/2)*gam^6*n^(5/2)*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)+128*omega^6*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*2^(1/2)*n^(1/2))*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*mu0*exp(-1/4*(-2*gam*n*z+4*gam*n*z0+z*2^(1/2)*n^(1/2)*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega)/n)/n/(gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)^3;
            %
            %                       M_local(2,1) = -1/2*mu0*exp(1/4*(2*gam*n*z-4*gam*n*z0+z*2^(1/2)*n^(1/2)*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega)/n)*(-16*omega^5*n*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)+4*omega^4*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*2^(1/2)*gam*n^2*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)-2*((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*omega^3*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*n*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*gam^2-16*omega^4*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*2^(1/2)*gam*n^(5/2)-2*((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*omega^5*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*n^(1/2)*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)+32*omega^5*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)+n^(3/2)*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*gam^2*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^3-16*omega^2*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*2^(1/2)*gam^3*n^(3/2)-16*((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*omega^5*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)+2*((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)*omega^2*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*gam^3*n^(3/2)+16*((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)*omega^4*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*gam*n^(1/2)-n^2*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*2^(1/2)*gam^3*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2-n^(5/2)*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*2^(1/2)*gam^5+32*omega^4*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*2^(1/2)*gam*n^(3/2)-32*omega^4*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*2^(1/2)*gam*n^(1/2)+12*n*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*gam^2*omega^3-8*omega^4*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*2^(1/2)*gam*n*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)+n^2*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*gam^4*omega-4*n^2*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*gam^2*omega^3+2*((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)*omega^4*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*gam*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*n-8*((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)*omega^4*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*gam*n^(3/2)+8*((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*omega^5*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*n*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)+4*omega^5*n^(1/2)*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2))/n/omega^2/(gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2);
            %                       M_local(2,2) = -1/2*mu0*exp(1/4*(2*gam*n*z-4*gam*n*z0+z*2^(1/2)*n^(1/2)*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega)/n)/n*(16*((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*omega^5*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)-32*omega^4*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*2^(1/2)*gam*n^(1/2)-2*((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)*omega^4*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*gam*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*n-16*omega^4*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*2^(1/2)*gam*n^(5/2)-2*((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)*omega^2*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*gam^3*n^(3/2)-16*((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)*omega^4*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*gam*n^(1/2)+n^(3/2)*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*gam^2*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^3+4*omega^4*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*2^(1/2)*gam*n^2*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)+2*((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*omega^3*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*n*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*gam^2-8*omega^4*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*2^(1/2)*gam*n*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)-16*omega^2*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*2^(1/2)*gam^3*n^(3/2)-n^2*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*2^(1/2)*gam^3*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2-4*n^2*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*gam^2*omega^3+2*((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*omega^5*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*n^(1/2)*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)+32*omega^5*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)-8*((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*omega^5*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*n*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)+n^2*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*gam^4*omega+12*n*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*gam^2*omega^3+4*omega^5*n^(1/2)*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)-16*omega^5*n*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)+8*((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)*omega^4*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*gam*n^(3/2)+32*omega^4*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*2^(1/2)*gam*n^(3/2)-n^(5/2)*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*2^(1/2)*gam^5)/omega^2/(gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2);
            %                       M_local(2,3) = -1/2*mu0*exp(-1/4*(-2*gam*n*z+4*gam*n*z0+z*2^(1/2)*n^(1/2)*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega)/n)*(n^2*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*2^(1/2)*gam^3*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2+n^2*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*gam^4*omega+2*((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)*omega^2*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*gam^3*n^(3/2)+16*omega^4*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*2^(1/2)*gam*n^(5/2)+8*omega^4*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*2^(1/2)*gam*n*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)-32*omega^4*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*2^(1/2)*gam*n^(3/2)+2*((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*omega^3*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*n*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*gam^2-16*omega^5*n*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)+16*((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*omega^5*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)-4*omega^4*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*2^(1/2)*gam*n^2*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)+16*((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)*omega^4*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*gam*n^(1/2)-8*((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)*omega^4*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*gam*n^(3/2)-4*n^2*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*gam^2*omega^3+2*((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)*omega^4*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*gam*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*n-8*((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*omega^5*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*n*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)+n^(5/2)*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*2^(1/2)*gam^5+32*omega^4*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*2^(1/2)*gam*n^(1/2)+n^(3/2)*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*gam^2*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^3+16*omega^2*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*2^(1/2)*gam^3*n^(3/2)+32*omega^5*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)+2*((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*omega^5*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*n^(1/2)*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)+12*n*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*gam^2*omega^3+4*omega^5*n^(1/2)*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2))/n/omega^2/(gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2);
            %                       M_local(2,4) = 1/2*mu0*exp(-1/4*(-2*gam*n*z+4*gam*n*z0+z*2^(1/2)*n^(1/2)*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega)/n)*(16*((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*omega^5*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)-4*omega^5*n^(1/2)*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)+4*n^2*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*gam^2*omega^3-8*((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)*omega^4*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*gam*n^(3/2)-12*n*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*gam^2*omega^3+2*((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)*omega^4*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*gam*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*n-16*omega^2*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*2^(1/2)*gam^3*n^(3/2)+2*((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*omega^5*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*n^(1/2)*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)+4*omega^4*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*2^(1/2)*gam*n^2*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)-n^2*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*2^(1/2)*gam^3*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2+2*((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*omega^3*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*n*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*gam^2+16*((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)*omega^4*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*gam*n^(1/2)+32*omega^4*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*2^(1/2)*gam*n^(3/2)+2*((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)*omega^2*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*gam^3*n^(3/2)+16*omega^5*n*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)-32*omega^4*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*2^(1/2)*gam*n^(1/2)-8*omega^4*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*2^(1/2)*gam*n*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)-n^(5/2)*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*2^(1/2)*gam^5-32*omega^5*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)-16*omega^4*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*2^(1/2)*gam*n^(5/2)-n^(3/2)*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*gam^2*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^3-8*((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*omega^5*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*n*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)-n^2*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*gam^4*omega)/n/omega^2/(gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2);
            %
            %                       M_local(3,1) = cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*exp(1/4*(2^(1/2)*n^(1/2)*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega-2*gam*n)*z/n);
            %                       M_local(3,2) = sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*exp(1/4*(2^(1/2)*n^(1/2)*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega-2*gam*n)*z/n);
            %                       M_local(3,3) = cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*exp(-1/4*(2^(1/2)*n^(1/2)*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega+2*gam*n)*z/n);
            %                       M_local(3,4) = exp(-1/4*(2^(1/2)*n^(1/2)*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega+2*gam*n)*z/n)*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z);
            %
            %                       M_local(4,1) = 1/4*1/omega^2/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*exp(1/4*(2^(1/2)*n^(1/2)*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega-2*gam*n)*z/n)*(4*((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)*omega^2*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)-cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*2^(1/2)*gam^2*n-8*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*2^(1/2)*omega^2+4*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*2^(1/2)*omega^2*n-cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*2^(1/2)*n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2+2*n^(1/2)*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*gam*omega);
            %                       M_local(4,2) = -1/4*exp(1/4*(2^(1/2)*n^(1/2)*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega-2*gam*n)*z/n)*(4*((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)*omega^2*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)+sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*2^(1/2)*gam^2*n+8*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*2^(1/2)*omega^2-4*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*2^(1/2)*omega^2*n+sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*2^(1/2)*n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2-2*n^(1/2)*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*gam*omega)/omega^2/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2);
            %                       M_local(4,3) = 1/4*exp(-1/4*(2^(1/2)*n^(1/2)*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega+2*gam*n)*z/n)*(4*((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)*omega^2*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)+cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*2^(1/2)*gam^2*n+8*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*2^(1/2)*omega^2-4*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*2^(1/2)*omega^2*n+cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*2^(1/2)*n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2+2*n^(1/2)*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*gam*omega)/omega^2/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2);
            %                       M_local(4,4) = 1/4*exp(-1/4*(2^(1/2)*n^(1/2)*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega+2*gam*n)*z/n)*(-4*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*2^(1/2)*omega^2*n+8*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*2^(1/2)*omega^2+sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*2^(1/2)*gam^2*n+sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*2^(1/2)*n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2+2*n^(1/2)*((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*sin(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z)*gam*omega-4*((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)*omega^2*cos(((gam^2*n^2+4*omega^2*n-4*omega^2)/omega^2)^(1/2)*2^(1/2)/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2)*omega*z))/omega^2/n^(1/2)/((gam^2*n+8*omega^2-4*omega^2*n+n^(1/2)*((gam^4*n+16*gam^2*omega^2+8*gam^2*omega^2*n+16*omega^4*n)/omega^4)^(1/2)*omega^2)/omega^2)^(1/2);
            %
            %

            % retrieve velocity:
            Q_local = [cos((n-1)^(1/2)/n^(1/2)*omega*z)*exp(1/n^(1/2)*omega*z), sin((n-1)^(1/2)/n^(1/2)*omega*z)*exp(1/n^(1/2)*omega*z), exp(-1/n^(1/2)*omega*z)*cos((n-1)^(1/2)/n^(1/2)*omega*z), exp(-1/n^(1/2)*omega*z)*sin((n-1)^(1/2)/n^(1/2)*omega*z)];

            % for rhs-terms
            P_local     =   [rho*g, omega*4*mu0*str_bg, 0, 0];


            % Add local coeffs to global ones
            if (i==1)
                M((ilay-2)*4+3:(ilay-2)*4+6,(ilay-2)*4+1:(ilay-2)*4+4) = M_local;
                P((ilay-1)*4-1:(ilay-1)*4+2,ilay)                      = -P_local;

            else
                M((ilay-2)*4+3:(ilay-2)*4+6,(ilay-2)*4+5:(ilay-2)*4+8) = -M_local;
                P((ilay-1)*4-1:(ilay-1)*4+2,ilay)                      = P((ilay-1)*4-1:(ilay-1)*4+2,ilay)+P_local(:);
            end

            Q(ilay,(ilay-1)*4+1:(ilay-1)*4+4) = Q_local;


        end

    elseif ilay==1
        % The upper boundary
        rho         =   rho_vec(ilay   );
        Hi          =   H_int  (ilay   );
        mu0         =   mu     (ilay   );
        n           =   n_vec  (ilay   );
        gam         =   gam_vec(ilay   );
        z           =   Hi;
        if (n==1); n=1.0000001; end

        switch upper_bound
            case {'free surface','free surface erosion'}
                M_local = [[2/n^(1/2)*mu0*omega*exp(1/n^(1/2)*omega*z)*cos((n-1)^(1/2)/n^(1/2)*omega*z), 2/n^(1/2)*mu0*omega*exp(1/n^(1/2)*omega*z)*sin((n-1)^(1/2)/n^(1/2)*omega*z), -2/n^(1/2)*mu0*omega*exp(-1/n^(1/2)*omega*z)*cos((n-1)^(1/2)/n^(1/2)*omega*z), -2/n^(1/2)*mu0*omega*exp(-1/n^(1/2)*omega*z)*sin((n-1)^(1/2)/n^(1/2)*omega*z)];...
                    [2*mu0*omega/n*exp(1/n^(1/2)*omega*z)*((n-1)^(1/2)*sin((n-1)^(1/2)/n^(1/2)*omega*z)-cos((n-1)^(1/2)/n^(1/2)*omega*z)), -2*mu0*omega/n*exp(1/n^(1/2)*omega*z)*((n-1)^(1/2)*cos((n-1)^(1/2)/n^(1/2)*omega*z)+sin((n-1)^(1/2)/n^(1/2)*omega*z)), -2*mu0*omega/n*exp(-1/n^(1/2)*omega*z)*((n-1)^(1/2)*sin((n-1)^(1/2)/n^(1/2)*omega*z)+cos((n-1)^(1/2)/n^(1/2)*omega*z)), 2*mu0*omega/n*exp(-1/n^(1/2)*omega*z)*((n-1)^(1/2)*cos((n-1)^(1/2)/n^(1/2)*omega*z)-sin((n-1)^(1/2)/n^(1/2)*omega*z))]];

                Q_local = [cos((n-1)^(1/2)/n^(1/2)*omega*z)*exp(1/n^(1/2)*omega*z), sin((n-1)^(1/2)/n^(1/2)*omega*z)*exp(1/n^(1/2)*omega*z), exp(-1/n^(1/2)*omega*z)*cos((n-1)^(1/2)/n^(1/2)*omega*z), exp(-1/n^(1/2)*omega*z)*sin((n-1)^(1/2)/n^(1/2)*omega*z)];
                P_local = [-rho*g, -4*mu0*omega*str_bg];

                %-----------------------------------------------------

            case 'free slip'
                M_local = [[2*mu0*omega/n*exp(1/n^(1/2)*omega*z)*((n-1)^(1/2)*sin((n-1)^(1/2)/n^(1/2)*omega*z)-cos((n-1)^(1/2)/n^(1/2)*omega*z)), -2*mu0*omega/n*exp(1/n^(1/2)*omega*z)*((n-1)^(1/2)*cos((n-1)^(1/2)/n^(1/2)*omega*z)+sin((n-1)^(1/2)/n^(1/2)*omega*z)), -2*mu0*omega/n*exp(-1/n^(1/2)*omega*z)*((n-1)^(1/2)*sin((n-1)^(1/2)/n^(1/2)*omega*z)+cos((n-1)^(1/2)/n^(1/2)*omega*z)), -2*mu0*omega/n*exp(-1/n^(1/2)*omega*z)*(-(n-1)^(1/2)*cos((n-1)^(1/2)/n^(1/2)*omega*z)+sin((n-1)^(1/2)/n^(1/2)*omega*z))];...
                    [cos((n-1)^(1/2)/n^(1/2)*omega*z)*exp(1/n^(1/2)*omega*z), sin((n-1)^(1/2)/n^(1/2)*omega*z)*exp(1/n^(1/2)*omega*z), exp(-1/n^(1/2)*omega*z)*cos((n-1)^(1/2)/n^(1/2)*omega*z), exp(-1/n^(1/2)*omega*z)*sin((n-1)^(1/2)/n^(1/2)*omega*z)]];


                Q_local = [cos((n-1)^(1/2)/n^(1/2)*omega*z)*exp(1/n^(1/2)*omega*z), sin((n-1)^(1/2)/n^(1/2)*omega*z)*exp(1/n^(1/2)*omega*z), exp(-1/n^(1/2)*omega*z)*cos((n-1)^(1/2)/n^(1/2)*omega*z), exp(-1/n^(1/2)*omega*z)*sin((n-1)^(1/2)/n^(1/2)*omega*z)];

                P_local = [0, 0];
                
            case 'no slip'
                M_local = [[1/n^(1/2)*exp(1/n^(1/2)*omega*z)*(-cos((n-1)^(1/2)/n^(1/2)*omega*z)+(n-1)^(1/2)*sin((n-1)^(1/2)/n^(1/2)*omega*z)), -1/n^(1/2)*exp(1/n^(1/2)*omega*z)*(sin((n-1)^(1/2)/n^(1/2)*omega*z)+(n-1)^(1/2)*cos((n-1)^(1/2)/n^(1/2)*omega*z)), 1/n^(1/2)*exp(-1/n^(1/2)*omega*z)*(cos((n-1)^(1/2)/n^(1/2)*omega*z)+(n-1)^(1/2)*sin((n-1)^(1/2)/n^(1/2)*omega*z)), 1/n^(1/2)*exp(-1/n^(1/2)*omega*z)*(sin((n-1)^(1/2)/n^(1/2)*omega*z)-(n-1)^(1/2)*cos((n-1)^(1/2)/n^(1/2)*omega*z))];... 
                            [cos((n-1)^(1/2)/n^(1/2)*omega*z)*exp(1/n^(1/2)*omega*z), sin((n-1)^(1/2)/n^(1/2)*omega*z)*exp(1/n^(1/2)*omega*z), exp(-1/n^(1/2)*omega*z)*cos((n-1)^(1/2)/n^(1/2)*omega*z), exp(-1/n^(1/2)*omega*z)*sin((n-1)^(1/2)/n^(1/2)*omega*z)]];
                Q_local = [cos((n-1)^(1/2)/n^(1/2)*omega*z)*exp(1/n^(1/2)*omega*z), sin((n-1)^(1/2)/n^(1/2)*omega*z)*exp(1/n^(1/2)*omega*z), exp(-1/n^(1/2)*omega*z)*cos((n-1)^(1/2)/n^(1/2)*omega*z), exp(-1/n^(1/2)*omega*z)*sin((n-1)^(1/2)/n^(1/2)*omega*z)];

                P_local = [0, 0];

            otherwise

                error('Upper BC not implemented!')

        end
        % used to compute Vz velocity at current interface


        % Add coeffs
        M(1:2,1:4) = M_local;
        Q(1  ,1:4) = Q_local;
        P(1:2,1  ) = P_local;

    elseif ilay==ninterface
        % The lower boundary
        rho         =   rho_vec(ilay-1  );
        Hi          =   H_int  (ilay    );
        mu0         =   mu     (ilay-1  );
        n           =   n_vec  (ilay-1  );
        gam         =   gam_vec(ilay-1  );
        z           =   Hi;

        if (n==1); n=1.0000001; end

        switch lower_bound
            case 'free slip'
                M_local = [[2*mu0*omega/n*exp(1/n^(1/2)*omega*z)*((n-1)^(1/2)*sin((n-1)^(1/2)/n^(1/2)*omega*z)-cos((n-1)^(1/2)/n^(1/2)*omega*z)), -2*mu0*omega/n*exp(1/n^(1/2)*omega*z)*((n-1)^(1/2)*cos((n-1)^(1/2)/n^(1/2)*omega*z)+sin((n-1)^(1/2)/n^(1/2)*omega*z)), -2*mu0*omega/n*exp(-1/n^(1/2)*omega*z)*((n-1)^(1/2)*sin((n-1)^(1/2)/n^(1/2)*omega*z)+cos((n-1)^(1/2)/n^(1/2)*omega*z)), -2*mu0*omega/n*exp(-1/n^(1/2)*omega*z)*(-(n-1)^(1/2)*cos((n-1)^(1/2)/n^(1/2)*omega*z)+sin((n-1)^(1/2)/n^(1/2)*omega*z))];...
                    [cos((n-1)^(1/2)/n^(1/2)*omega*z)*exp(1/n^(1/2)*omega*z), sin((n-1)^(1/2)/n^(1/2)*omega*z)*exp(1/n^(1/2)*omega*z), exp(-1/n^(1/2)*omega*z)*cos((n-1)^(1/2)/n^(1/2)*omega*z), exp(-1/n^(1/2)*omega*z)*sin((n-1)^(1/2)/n^(1/2)*omega*z)]];


                Q_local = [cos((n-1)^(1/2)/n^(1/2)*omega*z)*exp(1/n^(1/2)*omega*z), sin((n-1)^(1/2)/n^(1/2)*omega*z)*exp(1/n^(1/2)*omega*z), exp(-1/n^(1/2)*omega*z)*cos((n-1)^(1/2)/n^(1/2)*omega*z), exp(-1/n^(1/2)*omega*z)*sin((n-1)^(1/2)/n^(1/2)*omega*z)];

                P_local = [0, 0];

            case 'no slip'
                M_local = [[1/n^(1/2)*exp(1/n^(1/2)*omega*z)*(-cos((n-1)^(1/2)/n^(1/2)*omega*z)+(n-1)^(1/2)*sin((n-1)^(1/2)/n^(1/2)*omega*z)), -1/n^(1/2)*exp(1/n^(1/2)*omega*z)*(sin((n-1)^(1/2)/n^(1/2)*omega*z)+(n-1)^(1/2)*cos((n-1)^(1/2)/n^(1/2)*omega*z)), 1/n^(1/2)*exp(-1/n^(1/2)*omega*z)*(cos((n-1)^(1/2)/n^(1/2)*omega*z)+(n-1)^(1/2)*sin((n-1)^(1/2)/n^(1/2)*omega*z)), 1/n^(1/2)*exp(-1/n^(1/2)*omega*z)*(sin((n-1)^(1/2)/n^(1/2)*omega*z)-(n-1)^(1/2)*cos((n-1)^(1/2)/n^(1/2)*omega*z))];... 
                            [cos((n-1)^(1/2)/n^(1/2)*omega*z)*exp(1/n^(1/2)*omega*z), sin((n-1)^(1/2)/n^(1/2)*omega*z)*exp(1/n^(1/2)*omega*z), exp(-1/n^(1/2)*omega*z)*cos((n-1)^(1/2)/n^(1/2)*omega*z), exp(-1/n^(1/2)*omega*z)*sin((n-1)^(1/2)/n^(1/2)*omega*z)]];
                Q_local = [cos((n-1)^(1/2)/n^(1/2)*omega*z)*exp(1/n^(1/2)*omega*z), sin((n-1)^(1/2)/n^(1/2)*omega*z)*exp(1/n^(1/2)*omega*z), exp(-1/n^(1/2)*omega*z)*cos((n-1)^(1/2)/n^(1/2)*omega*z), exp(-1/n^(1/2)*omega*z)*sin((n-1)^(1/2)/n^(1/2)*omega*z)];

                P_local = [0, 0];
            otherwise

                error('Lower BC not implemented!')

        end


        % Add coeffs
        M((ilay-2)*4+3:(ilay-2)*4+4,neq-3:neq)  = M_local;
        Q(ilay,neq-3:neq)                       = Q_local;
        P(:,ilay  )                             = 0;

    end

end

%
%
% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% %%% verify the matrixes formed above
% mu_lo = mu(2);
% n_lo  = n_vec(2);
% mu_up = mu(1);
% n_up  = n_vec(1);
% Hi=H_int(2);
% A = [[2*mu_up*omega*(1/n_up)^(1/2)*exp((1/n_up)^(1/2)*omega)*cos((n_up-1)^(1/2)/(1/n_up)^(1/2)*omega/n_up), 2*mu_up*omega*(1/n_up)^(1/2)*exp((1/n_up)^(1/2)*omega)*sin((n_up-1)^(1/2)/(1/n_up)^(1/2)*omega/n_up), -2*mu_up*omega*(1/n_up)^(1/2)*exp(-(1/n_up)^(1/2)*omega)*cos((n_up-1)^(1/2)/(1/n_up)^(1/2)*omega/n_up), -2*mu_up*omega*(1/n_up)^(1/2)*exp(-(1/n_up)^(1/2)*omega)*sin((n_up-1)^(1/2)/(1/n_up)^(1/2)*omega/n_up), 0, 0, 0, 0]; [2*mu_up*omega/n_up*exp((1/n_up)^(1/2)*omega)*(-cos((n_up-1)^(1/2)/(1/n_up)^(1/2)*omega/n_up)+(n_up-1)^(1/2)*sin((n_up-1)^(1/2)/(1/n_up)^(1/2)*omega/n_up)), -2*mu_up*omega/n_up*exp((1/n_up)^(1/2)*omega)*(sin((n_up-1)^(1/2)/(1/n_up)^(1/2)*omega/n_up)+(n_up-1)^(1/2)*cos((n_up-1)^(1/2)/(1/n_up)^(1/2)*omega/n_up)), -2*mu_up*omega/n_up*exp(-(1/n_up)^(1/2)*omega)*(cos((n_up-1)^(1/2)/(1/n_up)^(1/2)*omega/n_up)+(n_up-1)^(1/2)*sin((n_up-1)^(1/2)/(1/n_up)^(1/2)*omega/n_up)), -2*mu_up*omega/n_up*exp(-(1/n_up)^(1/2)*omega)*(sin((n_up-1)^(1/2)/(1/n_up)^(1/2)*omega/n_up)-(n_up-1)^(1/2)*cos((n_up-1)^(1/2)/(1/n_up)^(1/2)*omega/n_up)), 0, 0, 0, 0]; [2*omega*(1/n_up)^(1/2)*mu_up*exp((1/n_up)^(1/2)*omega*Hi)*cos((n_up-1)^(1/2)/(1/n_up)^(1/2)*omega*Hi/n_up), 2*omega*(1/n_up)^(1/2)*mu_up*exp((1/n_up)^(1/2)*omega*Hi)*sin((n_up-1)^(1/2)/(1/n_up)^(1/2)*omega*Hi/n_up), -2*omega*(1/n_up)^(1/2)*mu_up*exp(-(1/n_up)^(1/2)*omega*Hi)*cos((n_up-1)^(1/2)/(1/n_up)^(1/2)*omega*Hi/n_up), -2*omega*(1/n_up)^(1/2)*mu_up*exp(-(1/n_up)^(1/2)*omega*Hi)*sin((n_up-1)^(1/2)/(1/n_up)^(1/2)*omega*Hi/n_up), -2*omega*(1/n_lo)^(1/2)*mu_lo*exp((1/n_lo)^(1/2)*omega*Hi)*cos((n_lo-1)^(1/2)/(1/n_lo)^(1/2)*omega*Hi/n_lo), -2*omega*(1/n_lo)^(1/2)*mu_lo*exp((1/n_lo)^(1/2)*omega*Hi)*sin((n_lo-1)^(1/2)/(1/n_lo)^(1/2)*omega*Hi/n_lo), 2*omega*(1/n_lo)^(1/2)*mu_lo*exp(-(1/n_lo)^(1/2)*omega*Hi)*cos((n_lo-1)^(1/2)/(1/n_lo)^(1/2)*omega*Hi/n_lo), 2*omega*(1/n_lo)^(1/2)*mu_lo*exp(-(1/n_lo)^(1/2)*omega*Hi)*sin((n_lo-1)^(1/2)/(1/n_lo)^(1/2)*omega*Hi/n_lo)]; [-2*omega/n_up*mu_up*exp((1/n_up)^(1/2)*omega*Hi)*(cos((n_up-1)^(1/2)/(1/n_up)^(1/2)*omega*Hi/n_up)-(n_up-1)^(1/2)*sin((n_up-1)^(1/2)/(1/n_up)^(1/2)*omega*Hi/n_up)), -2*omega/n_up*mu_up*exp((1/n_up)^(1/2)*omega*Hi)*(sin((n_up-1)^(1/2)/(1/n_up)^(1/2)*omega*Hi/n_up)+(n_up-1)^(1/2)*cos((n_up-1)^(1/2)/(1/n_up)^(1/2)*omega*Hi/n_up)), -2*omega/n_up*mu_up*exp(-(1/n_up)^(1/2)*omega*Hi)*(cos((n_up-1)^(1/2)/(1/n_up)^(1/2)*omega*Hi/n_up)+(n_up-1)^(1/2)*sin((n_up-1)^(1/2)/(1/n_up)^(1/2)*omega*Hi/n_up)), 2*omega/n_up*mu_up*exp(-(1/n_up)^(1/2)*omega*Hi)*(-sin((n_up-1)^(1/2)/(1/n_up)^(1/2)*omega*Hi/n_up)+(n_up-1)^(1/2)*cos((n_up-1)^(1/2)/(1/n_up)^(1/2)*omega*Hi/n_up)), -2*omega/n_lo*mu_lo*exp((1/n_lo)^(1/2)*omega*Hi)*(-cos((n_lo-1)^(1/2)/(1/n_lo)^(1/2)*omega*Hi/n_lo)+(n_lo-1)^(1/2)*sin((n_lo-1)^(1/2)/(1/n_lo)^(1/2)*omega*Hi/n_lo)), 2*omega/n_lo*mu_lo*exp((1/n_lo)^(1/2)*omega*Hi)*(sin((n_lo-1)^(1/2)/(1/n_lo)^(1/2)*omega*Hi/n_lo)+(n_lo-1)^(1/2)*cos((n_lo-1)^(1/2)/(1/n_lo)^(1/2)*omega*Hi/n_lo)), 2*omega/n_lo*mu_lo*exp(-(1/n_lo)^(1/2)*omega*Hi)*(cos((n_lo-1)^(1/2)/(1/n_lo)^(1/2)*omega*Hi/n_lo)+(n_lo-1)^(1/2)*sin((n_lo-1)^(1/2)/(1/n_lo)^(1/2)*omega*Hi/n_lo)), 2*omega/n_lo*mu_lo*exp(-(1/n_lo)^(1/2)*omega*Hi)*(sin((n_lo-1)^(1/2)/(1/n_lo)^(1/2)*omega*Hi/n_lo)-(n_lo-1)^(1/2)*cos((n_lo-1)^(1/2)/(1/n_lo)^(1/2)*omega*Hi/n_lo))]; [exp((1/n_up)^(1/2)*omega*Hi)*cos((n_up-1)^(1/2)/(1/n_up)^(1/2)*omega*Hi/n_up), exp((1/n_up)^(1/2)*omega*Hi)*sin((n_up-1)^(1/2)/(1/n_up)^(1/2)*omega*Hi/n_up), exp(-(1/n_up)^(1/2)*omega*Hi)*cos((n_up-1)^(1/2)/(1/n_up)^(1/2)*omega*Hi/n_up), exp(-(1/n_up)^(1/2)*omega*Hi)*sin((n_up-1)^(1/2)/(1/n_up)^(1/2)*omega*Hi/n_up), -exp((1/n_lo)^(1/2)*omega*Hi)*cos((n_lo-1)^(1/2)/(1/n_lo)^(1/2)*omega*Hi/n_lo), -exp((1/n_lo)^(1/2)*omega*Hi)*sin((n_lo-1)^(1/2)/(1/n_lo)^(1/2)*omega*Hi/n_lo), -exp(-(1/n_lo)^(1/2)*omega*Hi)*cos((n_lo-1)^(1/2)/(1/n_lo)^(1/2)*omega*Hi/n_lo), -exp(-(1/n_lo)^(1/2)*omega*Hi)*sin((n_lo-1)^(1/2)/(1/n_lo)^(1/2)*omega*Hi/n_lo)]; [-1/(1/n_up)^(1/2)/n_up*exp((1/n_up)^(1/2)*omega*Hi)*(cos((n_up-1)^(1/2)/(1/n_up)^(1/2)*omega*Hi/n_up)-(n_up-1)^(1/2)*sin((n_up-1)^(1/2)/(1/n_up)^(1/2)*omega*Hi/n_up)), -1/(1/n_up)^(1/2)/n_up*exp((1/n_up)^(1/2)*omega*Hi)*(sin((n_up-1)^(1/2)/(1/n_up)^(1/2)*omega*Hi/n_up)+(n_up-1)^(1/2)*cos((n_up-1)^(1/2)/(1/n_up)^(1/2)*omega*Hi/n_up)), 1/(1/n_up)^(1/2)/n_up*exp(-(1/n_up)^(1/2)*omega*Hi)*(cos((n_up-1)^(1/2)/(1/n_up)^(1/2)*omega*Hi/n_up)+(n_up-1)^(1/2)*sin((n_up-1)^(1/2)/(1/n_up)^(1/2)*omega*Hi/n_up)), -1/(1/n_up)^(1/2)/n_up*exp(-(1/n_up)^(1/2)*omega*Hi)*(-sin((n_up-1)^(1/2)/(1/n_up)^(1/2)*omega*Hi/n_up)+(n_up-1)^(1/2)*cos((n_up-1)^(1/2)/(1/n_up)^(1/2)*omega*Hi/n_up)), -1/(1/n_lo)^(1/2)/n_lo*exp((1/n_lo)^(1/2)*omega*Hi)*(-cos((n_lo-1)^(1/2)/(1/n_lo)^(1/2)*omega*Hi/n_lo)+(n_lo-1)^(1/2)*sin((n_lo-1)^(1/2)/(1/n_lo)^(1/2)*omega*Hi/n_lo)), 1/(1/n_lo)^(1/2)/n_lo*exp((1/n_lo)^(1/2)*omega*Hi)*(sin((n_lo-1)^(1/2)/(1/n_lo)^(1/2)*omega*Hi/n_lo)+(n_lo-1)^(1/2)*cos((n_lo-1)^(1/2)/(1/n_lo)^(1/2)*omega*Hi/n_lo)), -1/(1/n_lo)^(1/2)/n_lo*exp(-(1/n_lo)^(1/2)*omega*Hi)*(cos((n_lo-1)^(1/2)/(1/n_lo)^(1/2)*omega*Hi/n_lo)+(n_lo-1)^(1/2)*sin((n_lo-1)^(1/2)/(1/n_lo)^(1/2)*omega*Hi/n_lo)), -1/(1/n_lo)^(1/2)/n_lo*exp(-(1/n_lo)^(1/2)*omega*Hi)*(sin((n_lo-1)^(1/2)/(1/n_lo)^(1/2)*omega*Hi/n_lo)-(n_lo-1)^(1/2)*cos((n_lo-1)^(1/2)/(1/n_lo)^(1/2)*omega*Hi/n_lo))]; [0, 0, 0, 0, -2*mu_lo*omega/n_lo, -2*mu_lo*omega*(n_lo-1)^(1/2)/n_lo, -2*mu_lo*omega/n_lo, 2*mu_lo*omega*(n_lo-1)^(1/2)/n_lo]; [0, 0, 0, 0, 1, 0, 1, 0]];
%
% %M=A;
% %%% verify the matrixes formed above
% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%












%==========================================================================
%
% Now that the system of equations has been set up, we can compute the time
% evolution of the system

ntime       =   100;        % the approximate # of timesteps you want
time        =   0;
Ampl_Time   =   Ampl;
Time_vec    =   0;

% Compute an initial velocity and from this growthrate, to estimate a reasonable timestep
RHS                 =   P*Ampl(1:ninterface);   % RHS
C                   =   M\RHS;                  % Solve for coefficients
Vel                 =   Q*C - 1*str_bg*Ampl;      % Compute velocity
%

% For debugging, this is used:
% z       = Hi;
% Vel_int = (C(1)*cos(2/n_up*(n_up-1)^(1/2)*2^(1/2)/(-4+8/n_up+16^(1/2))^(1/2)*omega*z)+C(2)*sin(2/n_up*(n_up-1)^(1/2)*2^(1/2)/(-4+8/n_up+16^(1/2))^(1/2)*omega*z))*exp(1/4*2^(1/2)*(-4+8/n_up+16^(1/2))^(1/2)*omega*z)+(C(3)*cos(2/n_up*(n_up-1)^(1/2)*2^(1/2)/(-4+8/n_up+16^(1/2))^(1/2)*omega*z)+C(4)*sin(2/n_up*(n_up-1)^(1/2)*2^(1/2)/(-4+8/n_up+16^(1/2))^(1/2)*omega*z))*exp(-1/4*2^(1/2)*(-4+8/n_up+16^(1/2))^(1/2)*omega*z);
%
%
% Vel_int1 = ((C(5)*cos(2/n_lo*(n_lo-1)^(1/2)*2^(1/2)/(-4+8/n_lo+16^(1/2))^(1/2)*omega*z)+C(6)*sin(2/n_lo*(n_lo-1)^(1/2)*2^(1/2)/(-4+8/n_lo+16^(1/2))^(1/2)*omega*z))*exp(1/4*2^(1/2)*(-4+8/n_lo+16^(1/2))^(1/2)*omega*z)+(C(7)*cos(2/n_lo*(n_lo-1)^(1/2)*2^(1/2)/(-4+8/n_lo+16^(1/2))^(1/2)*omega*z)+C(8)*sin(2/n_lo*(n_lo-1)^(1/2)*2^(1/2)/(-4+8/n_lo+16^(1/2))^(1/2)*omega*z))*exp(-1/4*2^(1/2)*(-4+8/n_lo+16^(1/2))^(1/2)*omega*z));
%
% z       = 1;
% Vel_surf = (C(1)*cos(2/n_up*(n_up-1)^(1/2)*2^(1/2)/(-4+8/n_up+16^(1/2))^(1/2)*omega*z)+C(2)*sin(2/n_up*(n_up-1)^(1/2)*2^(1/2)/(-4+8/n_up+16^(1/2))^(1/2)*omega*z))*exp(1/4*2^(1/2)*(-4+8/n_up+16^(1/2))^(1/2)*omega*z)+(C(3)*cos(2/n_up*(n_up-1)^(1/2)*2^(1/2)/(-4+8/n_up+16^(1/2))^(1/2)*omega*z)+C(4)*sin(2/n_up*(n_up-1)^(1/2)*2^(1/2)/(-4+8/n_up+16^(1/2))^(1/2)*omega*z))*exp(-1/4*2^(1/2)*(-4+8/n_up+16^(1/2))^(1/2)*omega*z);
%
q_vec               =   abs(Vel)./abs(Ampl);
q_vec(isinf(q_vec)) = 0;
q_vec(isnan(q_vec)) = 0;


q                   = max(q_vec(Ind_interface))/abs(str_bg);
%q = q_vec(Ind_interface);
%q                   =   max(Vel(2:end-1))./max(Ampl(2:end-1))/10;
dt                  =   real(log(Ampl_max./max(Ampl(2:end-1)))./(q)./(ntime-1));      % A=A0*exp(qt) -> t = log(A/A0)/q/ntime;
%dt = time_end/ntime;

% There are two ways in which we can do the timestepping.
%  (1) the 'classical' way with explicit euler timesteps:
%       dA/dt  =   Q*inv(M)*P*A - str_bg*A;
%       dA/dt  ~ (Anew-A)/dt
%    so:
%       Anew   = A + dt*(Q*inv(M)*P - str_bg)*A
%
%  (2) the 'implicit' way in which we discretize the timestep as:
%       dA/dt  ~ (A-Aold)/dt
%       (A-Aold)/dt = Q*inv(M)*P*A - str_bg*A  - k*omega^2*A
%                     RT & folding      BG         Erosion
%       A - dt*[(Q*inv(M)*P)  - str_bg + k*omega^2]*A   = Aold
%    or:
%       G*A = Aold;
%       where G = eye(size(M)) - dt*(Q*inv(M)*P + eye(ninterface,ninterface)*str_bg)
%       which can be solved for A
%




TimeStepMethod  =   {'Explicit','Implicit'};
TimeStepMethod  =   TimeStepMethod{2};
itime=0;
%or itime=2:ntime*20

switch TimeStepMethod
    case 'Explicit'
        G_factor = (Q*inv(M)*P - 1*eye(ninterface, ninterface)*str_bg);
    case 'Implicit'
        G_factor = (Q*inv(M)*P - eye(ninterface,ninterface)*str_bg);
end

Ampl_Time= zeros(ninterface,ntime*10);
Vel_Time= zeros(ninterface,ntime*10);

while Ampl(Ind_interface,end)<Ampl_max    
    
    switch TimeStepMethod
        case 'Explicit'
            % Explicit timestepping
            G                   =   G_factor*dt;

            Ampl_new            =   abs(G*Ampl) + Ampl; %  - str_bg*Ampl*dt;

            %  Ampl_new            =   -str_bg*Ampl*dt + Ampl;

            Ampl_new_noEro        =   Ampl_new;
            % Erode the upper boundary with a finite erosion rate
            Ampl_top    =   Ampl_new(1);

            % Erosion, assuming dh/dt=k* (d2 h /dx2), under the assumption that h=h(t)*cos(omega*x)
            Ampl_top    =   Ampl_top*exp(-k*omega^2*dt);
            Ampl_new(1) =   Ampl_top;

        case 'Implicit'
            % Implicit timestepping
           % G                   =   eye(ninterface,ninterface)-(Q*inv(M)*P - eye(ninterface,ninterface)*str_bg)*dt;
            G = eye(ninterface,ninterface)-G_factor*dt;
            
            % Add erosion to the implicit solver
            %  Er. is given by:   (Anew-A)/dt = -Anew*k*omega^2
            %         Er*Anew = A
            %       where Er(1,1) =  1+dt*k*omega^2
            Ero                 =   zeros(ninterface,ninterface);
            Ero(1,1)            =   dt*k*omega^2;

            Ampl_new_noEro      =   Ampl;
           % Ampl_new_noEro     =   G\Ampl;
            G                  =    G+Ero;
            Ampl_new            =   G\Ampl;



    end
  %  Vel_Erosion         =   real(Ampl_new_noEro(1)-Ampl_new(1))/dt; % Erosion rate
    Vel_Erosion=0;
  
    Ampl_new            =   real(Ampl_new);


    % Compute velocity (for postprocessing)
    Vel                 =   (Ampl_new-Ampl)./dt;

    % Advance in time
    time                =   time + dt;

    % Store info
    itime= itime+1;
    Ampl_Time(:,itime)          =   Ampl_new;
    Vel_Time(:,itime)           =   Vel;
    Time_vec(itime)             =   time;
    Vel_Erosion_Time(itime)     =   Vel_Erosion;
    
    q_time(itime)               =   Vel(Ind_interface)/Ampl_new(Ind_interface);                        

    % Update amplitude
    Ampl                =   real(Ampl_new);

    %if max(real(Ampl_new))>Ampl_max
    if abs(Ampl_new(Ind_interface))>Ampl_max

        break
    end
    
    dt=dt*1.01;
    
    
   % if itime>2
   %     break
   % end
end
%
%
%==========================================================================


% Compute growthrate based on the finite amplitude analysis
%   Assumption:  A=A0*exp(q*t)
%       So: q = log(A./A0)/dt

q   =   (log(Ampl_Time(:,itime)./Ampl_Time(:,2))./(Time_vec(end)-Time_vec(2))+ 0*str_bg)/abs(str_bg);



%
q_dom=-q(Ind_interface);   % for finding the dominant wavelength, using fminbnd




%q_dom = -q_time(end)

