#===============================================================================
# Salt domes setup
#===============================================================================

# Define number of elements in x,y & z-direction
# Negative number implies corresponding number of mesh segments
# Data is provided in the variables seg_x, seg_y, seg_z and includes:
#    * coordinates of the delimiters between the segments (n-1 points)
#    * number of cells                                    (n points)
#    * bias coefficients                                  (n points) 

nel_x = 200
nel_y = 2
nel_z = 80

# Scaling
units = geo

Characteristic.Length      = 10000.0
Characteristic.Viscosity   = 1e19
Characteristic.Temperature = 1
Characteristic.Stress      = 1e6

# Geometry
L       =  0.125 # Length (y-direction)
W       =  20.0  # Width  (x-direction)
H       =  5.0   # Height (z-direction)
x_left  = -10.0  # Left side of domain
y_front =  0.0   # Front side of domain
z_bot   = -5.0   # Bottom of box

# Model setup and noise

msetup = domes

# Define input/output and numerics-related stuff
OutputFile      = domes
save_timesteps  = 1    # save every ? timesteps
time_end        = 1500 # last timestep
#time_end       = 1 # last timestep

CFL             = 0.3  # CFL, dt-based criterium
dt_max          = 0.2  # Maximum timestep

# Boundary conditions
BC.LeftBound				=	1				# 0 - free surface, 1-free slip with BG strainrate Eyy, 2 - no slip, 5 - growthrate 2D, 7 - growthrate 3D
BC.RightBound				=	1				# 0 - free surface, 1-free slip with BG strainrate Eyy, 2 - no slip, 5 - growthrate 2D, 7 - growthrate 3D
BC.FrontBound				=	1				# 0 - free surface, 1-free slip with BG strainrate Exx, 2 - no slip, 5 - growthrate 2D, 7 - growthrate 3D
BC.BackBound				=	1				# 0 - free surface, 1-free slip with BG strainrate Exx, 2 - no slip, 5 - growthrate 2D, 7 - growthrate 3D
BC.LowerBound				=	1				# 0 - free surface, 1-free slip, 				  2 - no slip, 5 - growthrate 2D, 7 - growthrate 3D
BC.UpperBound				=	1				# 0 - free surface, 1-free slip, 				  2 - no slip, 5 - growthrate 2D, 7 - growthrate 3D
Temp_top	    			=   0				# Temperature @ top
Temp_bottom					=   1 				# Temperature @ bottom; side BC's are flux-free

# Phase distribution
NumPartX   = 2   # Particles/Cell in x-direction
NumPartY   = 1   # Particles/Cell in y-direction
NumPartZ   = 3   # Particles/Cell in z-direction

# Properties that are defined over the whole domain:
Gravity =  -10.0; # [m/s2] - gravitational acceleration
Xi      =   0;    # [ ]    - Shear heating factor - not implemented yet

LowerViscosityCutoff = 1e18
UpperViscosityCutoff = 1e27
DII_ref              = 1e-15

#===============================================================================
# ............................ PETSc options ...................................
#===============================================================================

<PetscOptionsStart>

	-dt 0.2
	-use_fdstag_canonical
	-use_marker_control
	-objects_dump
	-AddRandomNoiseParticles 0
	-restart 0
	-save_breakpoints 0

#	-SkipStokesSolver 1
#	-shift_press
#	-SavePartitioning
#	-AVDPhaseViewer 1
#	-FSSA 1.0

# variable background strain rate

	-ExxNumPeriods  2
	-ExxTimeDelims  100.0
	-ExxStrainRates 0.0,1e-15

#	-EyyNumPeriods  2
#	-EyyTimeDelims  200.0
#	-EyyStrainRates 0.0,1e-16

# SNES

	-snes_npicard 3
	-snes_monitor
	-snes_atol 1e-12
	-snes_rtol 1e-6
	-snes_stol 1e-6
	-snes_max_it 25
	-snes_max_funcs 50000
	-snes_type ksponly
	-res_log

# Jacobian solver

	-js_ksp_type fgmres
	-js_ksp_max_it 1000
	-js_ksp_converged_reason
 	-js_ksp_monitor
	-js_ksp_rtol 1e-6

# Preconditioner

#	-pcmat_type block
#	-pcmat_pgamma 1e3
#	-jp_type bf
#	-bf_vs_type user
#	-vs_ksp_type preonly
#	-vs_pc_type lu
#	-vs_pc_factor_mat_solver_package mumps

#	-pcmat_type block
#	-pcmat_no_dev_proj
#	-jp_type bf
#	-bf_vs_type mg
#	-vs_ksp_type preonly

#	-pcmat_type mono
#	-jp_type mg

#	-gmg_pc_view
#	-gmg_dump
#	-gmg_pc_type mg
#	-gmg_pc_mg_levels 4
#	-gmg_pc_mg_galerkin
#	-gmg_pc_mg_type multiplicative
#	-gmg_pc_mg_cycle_type v

#	-gmg_mg_levels_ksp_type richardson
#	-gmg_mg_levels_ksp_richardson_scale 0.5
#	-gmg_mg_levels_ksp_max_it 20
#	-gmg_mg_levels_pc_type jacobi

#	-crs_ksp_type preonly
#	-crs_pc_type lu
#	-crs_pc_factor_mat_solver_package mumps

	-pcmat_type mono
	-pcmat_pgamma 1e3

	-jp_type user
	-jp_pc_type lu
	-jp_pc_factor_mat_solver_package mumps

# free surface

	-surf_use        1
	-surf_level     -4.0
	-surf_air_phase  0
	-surf_max_angle  45.0

	-out_surf_pvd        1
	-out_surf_velocity   1
	-out_surf_topography 1
	-out_surf_amplitude  1

# erosion/sedimentation

	-ErosionModel 1
	-SedimentModel 1
	-numLayers 7
	-timeDelims 19.0,26.0,34.0,114.0,130.0,205.5
	-sedRates 0.002226,0.023457,0.011988,0.000244,0.00025,0.000077,0.000721
	-sedPhases 3,4,3,4,3,4,3,

# salt domes setup

	-domes_salt_bot -4.5
	-domes_salt_top -4.2
	-rho_fluid 1000.0

# output flags

	-out_pvd 1
	-out_phase 1  
	-out_density 1
	-out_viscosity 1
	-out_velocity 1
	-out_pressure 1
	-out_temperature 1 
	-out_dev_stress 1
	-out_j2_dev_stress 1
	-out_strain_rate 1
	-out_j2_strain_rate 1
	-out_moment_res 1
	-out_cont_res 1

<PetscOptionsEnd>
    
#===============================================================================
# ............................ Material Parameters .............................
#===============================================================================

	# Water -----------------
	<MaterialStart>
		ID   = 0
		rho0 = 1000.0
		eta  = 1e18
	<MaterialEnd>

	# Base -------------------
	<MaterialStart>
		ID   = 1
		rho0 = 3000.0
		eta  = 1e21
	<MaterialEnd>

	# Salt -----------------
	<MaterialStart>
		ID   = 2
		rho0 = 2300.0
		eta  = 1e19
	<MaterialEnd>

	# Sediment layer #1 -----------------
	<MaterialStart>
		ID    = 3
		rho0  = 2700.0
		rho_n = 0.4173
		rho_c = 4.0032e-4
		eta   = 1e23
	<MaterialEnd>

	# Sediment layer #2 -----------------
	<MaterialStart>
		ID    = 4
		rho0  = 2700.0
		rho_n = 0.4173
		rho_c = 4.0032e-4
		eta   = 1e23
	<MaterialEnd>

#===============================================================================

